<html>
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <script src="{{ url_for('static', filename='jquery/1.11.1/jquery.min.js') }}"></script>
		<script src="{{ url_for('static', filename='libs/jqueryui/jquery.ui-1.9.0.min.js') }}"></script>		
	<!-- 引入 Bootstrap -->
	<!--
		<link href="/u/phyan/workspace/python/qor_analyzer/libs/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">	
		-->
		<script type="text/javascript" src="{{ url_for('static', filename='bootstrap/js/bootstrap.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='bootstrap/js/Chart_v1.js') }}"></script>
		<style type="text/css" src="{{ url_for('static', filename='bootstrap/css/bootstrap.css') }}"></style>
		<meta name="description" content="">
	    <meta name="author" content="">

	    <title>QoR Analyzer Web ^_^</title>

	    <!-- Bootstrap core CSS -->
	    <link href="{{ url_for('static', filename='bootstrap/3.3.5/css/bootstrap.min.css') }}" rel="stylesheet">
	    <!-- Bootstrap theme -->
	    <link href="{{ url_for('static', filename='bootstrap/css/bootstrap-theme.min.css') }}" rel="stylesheet">
	    <!-- Custom styles for this template -->
	    <link href="{{ url_for('static', filename='bootstrap/css/theme.css') }}" rel="stylesheet">
        <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/ladda-bootstrap-master/dist/ladda-themeless.min.css') }}">
		<script src="{{ url_for('static', filename='bootstrap/ladda-bootstrap-master/dist/spin.min.js') }}"></script>
		<script src="{{ url_for('static', filename='bootstrap/ladda-bootstrap-master/dist/ladda.min.js') }}"></script>
	</head>


	<body role="document" style="background-image: url('{{ url_for('static', filename='bootstrap/images/qor_analyzer.jpg') }}'); background-size:100% 100%;">
	<style>
	.navbar .nav>li>a{padding: 15px 10px 15px 10px}

	.metrics-nav-other>li {font-size:14px; padding: 0px 10px 0px 10px; color:white;}
	.metrics-nav-other>li>a {font-size:13px; padding: 4px 8px; color:white;border-left: 2px solid rgb(239, 239, 239);}

	.metrics-nav>li {font-size:14px; padding: 0px 10px 0px 10px; color:white;}
	.metrics-nav>li>a {font-size:13px; padding: 4px 8px; color:white;border-left: 2px solid rgb(239, 239, 239);}	
	.metrics-nav>li>a:hover {color:#563d7c;border-left: 2px solid #563d7c;text-decoration: none;}

	.checkbox-nav>li {font-size:13px; padding: 0px 10px 0px 10px; color:white;}
	.checkbox-nav-other>li {font-size:14px; padding: 0px 10px 0px 10px; color:white;}

	div.active-design{display: block;}
	div.inactive-design{display: none;}
	div.active-metrics{display: block;}
	div.inactive-metrics{display: none;}
	canvas.active-design{display: block;}
	canvas.inactive-design{display: none;}
	.col-md-1 .col-md-3 .col-md-12 {min-height: 0px;}


	.active_nav {display: block}
	.inactive_nav {display: none}

	.qor_charts {display: none;}

	</style>
	<script type="text/javascript">
		$(function() {
			window.pattern = "{{pattern|safe}}";
			window.script_list = {{script_list|safe}};
			//console.log(window.pattern,window.script_list);
			var qorArray = Array();
			window.active_design = "{{active_design|safe}}";
			window.active_metrics = "{{active_metrics|safe}}";
			window.active_pattern = "{{active_pattern|safe}}";
			//console.log(window.active_design,window.active_metrics,window.active_pattern);
			window.prev_d = -1;
			window.prev_p = -1;
			window.crnt_d = -1;
			window.crnt_p = -1;
			var dir_list = {{dir_list|safe}};
			if (window.active_metrics != "undefined" && window.active_metrics != "None") {
				console.log("Share by metrics")
				window.prev_d = {{point_dict['prev_d']|safe}};
				window.prev_p = {{point_dict['prev_p']|safe}};
				window.crnt_d = {{point_dict['crnt_d']|safe}};
				window.crnt_p = {{point_dict['crnt_p']|safe}};
				//var metrics_name = window.active_metrics;
				//var metrics_catogory = $(tmp).attr('class').split(" ")[0];
				$("#design-name").html("Select by design");
				$("#metrics-name").html(window.active_metrics);
				var cmd= "{{cmd|safe}}";
				var compress = "{{compress|safe}}";
				$("#qor_charts").css("display","block");
				$("#chart_nav").empty();
				$("#tab-content").empty();
				$('#qor_comp_nav').empty();
				$("#link_nav").empty();
				window.l = Ladda.create( document.querySelector( '#metrics-name' ) );
	 			window.l.start();
				
				$.post('display_metrics_chart', {
			        active_metrics: window.active_metrics,
			        selected_pattern: window.active_pattern,
			        dir_list: dir_list,
			        cmd: cmd,
			        compress: compress,
    		        pattern: window.pattern,
		        	script_list: window.script_list,
			    }, function () {
			    	console.log("sending post...")
			    })
			    .done(function(data) {
			    	window.l.stop();
			    	displayMetricsCharts(data);
			    	window.active_pattern = "{{active_pattern|safe}}";
			    	;

			    	if (window.crnt_p != -1) {
						var qorArray = Array();
						var datasetIndex = window.crnt_d;
						var pointIndex = window.crnt_p;
						var color_list = data['color_list'];
				    	var qor_dict = data['design_qor'][window.active_design]
				    	var metrics_order_dict = data['metrics_order_dict'];
						var metrics_order = metrics_order_dict[window.active_pattern];
				    	var qorArray = Array();
				    	var step_qor_list = qor_dict["step_qor_dict"][pattern];
				    	var steps_list = qor_dict["steps_dict"][window.active_pattern]
						qorArray = step_qor_list[datasetIndex][pointIndex]; //2:wns, 3:tns, etc	
						step_name = steps_list[datasetIndex][pointIndex];
						$("#first_name").val(step_name.split(')')[1]);
						$("#single_name").val(step_name.split(')')[1]);
						if (step_name.length > 10) {
				    		step_name = step_name.substr(0,12)
				    	}
						$("#"+window.active_pattern+"_"+"crnt_label").text(step_name);
						$("#"+window.active_pattern+"_"+"crnt_label").css("color", color_list[datasetIndex]);
						$.each(metrics_order, function(i,metrics) {
							var crnt = $("#"+window.active_pattern+"_"+metrics+">.crnt");
							crnt.text(qorArray[i]);
						});
					}

					if (window.prev_p != -1) {
						var qorArray = Array();
						var datasetIndex = window.prev_d;
						var pointIndex = window.prev_p;
						qorArray = step_qor_list[datasetIndex][pointIndex]; //2:wns, 3:tns, etc	
						step_name = steps_list[datasetIndex][pointIndex];
						$("#first_name").val(step_name.split(')')[1]);
						$("#single_name").val(step_name.split(')')[1]);
						if (step_name.length > 10) {
				    		step_name = step_name.substr(0,12)
				    	}
						$("#"+window.active_pattern+"_"+"prev_label").text(step_name);
						$("#"+window.active_pattern+"_"+"prev_label").css("color", color_list[datasetIndex]);
						$.each(metrics_order, function(i,metrics) {
				    		var crnt = $("#"+window.active_pattern+"_"+metrics+">.crnt");
			    			var prev = $("#"+window.active_pattern+"_"+metrics+">.prev");
			    			var pct = $("#"+window.active_pattern+"_"+metrics+">.pct");

			    			prev.text(qorArray[i]);
			    			var pct_value = (parseFloat(crnt.text()) / parseFloat(prev.text())) * 100 - 100
			    			if (pct_value > 10000) {
			    				pct_value = parseInt(pct_value).toExponential(2)
			    				pct.text(pct_value)
			    			} else {
			    				pct.text(pct_value.toFixed(2));
			    			}
			    			
					    	if (parseFloat(crnt.text()) > parseFloat(prev.text())) {
					    		crnt.css("color", "red");
					    		pct.css("color", "red");							    		
					    	} else if (parseFloat(crnt.text()) < parseFloat(prev.text())) {
					    		crnt.css("color", "green");
					    		pct.css("color", "green");
					    	} else {
					    		crnt.css("color", "black");
					    		pct.css("color", "black");
					    	}
						});
					}	
			    	console.log("pass!")
			    	
			    })
			    .fail(function() {
			        //$(destId).text("Error: Could not contact server.");
			        //l.stop();
			        window.l.stop();
			        console.log("fail!")
			        
			    });				
			} else if (window.active_design != "undefined" && window.active_design != "None") {
				console.log("Share by design")
				window.prev_d = {{point_dict['prev_d']|safe}};
				window.prev_p = {{point_dict['prev_p']|safe}};
				window.crnt_d = {{point_dict['crnt_d']|safe}};
				window.crnt_p = {{point_dict['crnt_p']|safe}};
				$("#design-name").html(window.active_design);
				$("#metrics-name").html("Select by metrics");

				var cmd= "{{cmd|safe}}";
				var compress = "{{compress|safe}}";
				$("#qor_charts").css("display","block");
				$("#chart_nav").empty();
				$("#tab-content").empty();
				$('#qor_comp_nav').empty();
				$("#link_nav").empty();
				window.l = Ladda.create( document.querySelector( '#design-name' ) );
	 			window.l.start();
				
				$.post('display_design_chart', {
			        active_design: window.active_design,
			        dir_list: dir_list,
			        cmd: cmd,
			        compress: compress,
    		        pattern: window.pattern,
		        	script_list: window.script_list,
			    }, function () {
			    	console.log("sending post...")
			    })
			    .done(function(data) {
			    	displayDesignCharts(data);		
			    		
			    	window.active_pattern = "{{active_pattern|safe}}";			    	
					//activate shared point/pattern
					var color_list = data['color_list'];
					var qorArray = Array();
					pattern_list = Object.keys(data['qor_metrics_dict']);
					var active_num = jQuery.inArray(window.active_pattern, pattern_list);
					var step_qor_dict = data['step_qor_dict'];
					var step_qor_list = step_qor_dict[window.active_pattern];
					var steps_dict = data['steps_dict'];
					var steps_list = steps_dict[window.active_pattern];
					var metrics_order_dict = data['metrics_order_dict'];
					//console.log(metrics_order_dict);
					var metrics_order = metrics_order_dict[window.active_pattern];
					var selected_pattern = window.active_pattern;
					//$("#chart_nav li").eq(active_num).tab("show");				
					$(".pattern_nav").addClass('inactive_nav');
					$(".pattern_nav").removeClass('active_nav');
					$("."+selected_pattern+"_nav").removeClass('inactive_nav');
					$("."+selected_pattern+"_nav").addClass('active_nav');

					//$('.nav-tabs a[href="#'+selected_pattern+'"]').tab('show'); // this will cause chartjs canvas not update (need size window manually) when tab switch to prev inactive tab
					/*
					$(".tab-pane").removeClass("active");
					$(".tab-pane").addClass("inactive");
					$("#"+selected_pattern).addClass("active");
					$("#"+selected_pattern).removeClass("inactive");
					*/
					/*
					$.each(pattern_list, function(i, pattern) {
						$("#"+pattern).addClass('inactive');
						$("#"+pattern).removeClass('active');
					})
					*/
					
					if (window.crnt_p != -1) {
						var qorArray = Array();
						var datasetIndex = window.crnt_d;
						var pointIndex = window.crnt_p;
						qorArray = step_qor_list[datasetIndex][pointIndex]; //2:wns, 3:tns, etc	
						step_name = steps_list[datasetIndex][pointIndex];
						$("#first_name").val(step_name.split(')')[1]);
						$("#single_name").val(step_name.split(')')[1]);
						if (step_name.length > 10) {
				    		step_name = step_name.substr(0,12)
				    	}

						$("#"+window.active_pattern+"_"+"crnt_label").text(step_name);
						$("#"+window.active_pattern+"_"+"crnt_label").css("color", color_list[datasetIndex]);
						$.each(metrics_order, function(i,metrics) {
							var crnt = $("#"+window.active_pattern+"_"+metrics+">.crnt");
							crnt.text(qorArray[i]);
						});
					}

					if (window.prev_p != -1) {
						var qorArray = Array();
						var datasetIndex = window.prev_d;
						var pointIndex = window.prev_p;

						qorArray = step_qor_list[datasetIndex][pointIndex]; //2:wns, 3:tns, etc	
						step_name = steps_list[datasetIndex][pointIndex];
						$("#first_name").val(step_name.split(')')[1]);
						$("#single_name").val(step_name.split(')')[1]);
						if (step_name.length > 10) {
				    		step_name = step_name.substr(0,12)
				    	}

						$("#"+window.active_pattern+"_"+"prev_label").text(step_name);
						$("#"+window.active_pattern+"_"+"prev_label").css("color", color_list[datasetIndex]);
						$.each(metrics_order, function(i,metrics) {
				    		var crnt = $("#"+window.active_pattern+"_"+metrics+">.crnt");
			    			var prev = $("#"+window.active_pattern+"_"+metrics+">.prev");
			    			var pct = $("#"+window.active_pattern+"_"+metrics+">.pct");
			    			prev.text(qorArray[i]);
			    			var pct_value = (parseFloat(crnt.text()) / parseFloat(prev.text())) * 100 - 100
							if (pct_value > 10000) {
			    				pct_value = parseInt(pct_value).toExponential(2)
			    				pct.text(pct_value)
			    			} else {
			    				pct.text(pct_value.toFixed(2));
			    			}	    			
					    	if (parseFloat(crnt.text()) > parseFloat(prev.text())) {
					    		crnt.css("color", "red");
					    		pct.css("color", "red");							    		
					    	} else if (parseFloat(crnt.text()) < parseFloat(prev.text())) {
					    		crnt.css("color", "green");
					    		pct.css("color", "green");
					    	} else {
					    		crnt.css("color", "black");
					    		pct.css("color", "black");
					    	}
						});
					}			  	    
			    	console.log("pass!")
			    	window.l.stop();
			    })
			    .fail(function() {
			        //$(destId).text("Error: Could not contact server.");
			        //l.stop();
			        console.log("fail!")
			        window.l.stop();
			    });
			} 
		});

		function activeChange(tmp){			
			var dir_list = {{dir_list|safe}};
			var stage = "{{cmd|safe}}";
			flow_dir = dir_list[0];
			var pattern = window.active_pattern;
			// var step_name = $("#first_name").val();
			$("#first_dir").val(flow_dir);
			$("#first_stage").val(stage);
			$("#first_pattern").val(pattern);
			console.log("enter start process");
			$("#mode").val("1");
		}


		function activeChange1(tmp){
			
			var dir_list = {{dir_list|safe}};
			var stage ="{{cmd|safe}}";
			flow_dir = dir_list[0];
			var pattern = window.active_pattern;
			// var step_name = $("#first_name").val();
			$("#first_dir").val(flow_dir);
			$("#first_stage").val(stage);
			$("#first_pattern").val(pattern);
			console.log("enter start process");
			$("#mode").val("2");

		}

		function activeDesign(tmp) {
			$("#show_name").css("display","table-cell");
			$("#first_name").val("");
			$("#second_name").val("");
			$("#single_name").val("");
			window.l = Ladda.create( document.querySelector( '#design-name' ) );
			if (!window.l.isLoading()) {
				window.prev_d = -1;
				window.prev_p = -1;
				window.crnt_d = -1;
				window.crnt_p = -1;
				window.active_metrics = undefined;
				var design_name = $(tmp).attr('class').split(" ")[1];
				$("#design-name").html(design_name);
				$("#metrics-name").html("Select by metrics");
				var dir_list = {{dir_list|safe}};
				var cmd= "{{cmd|safe}}";
				var compress = "{{compress|safe}}";
				$("#qor_charts").css("display","block");
				$("#chart_nav").empty();
				$("#tab-content").empty();
				$('#qor_comp_nav').empty();
				$("#link_nav").empty();
				window.l = Ladda.create( document.querySelector( '#design-name' ) );
	 			window.l.start();
				//console.log(window.pattern);
				$.post('display_design_chart', {
			        active_design: design_name,
			        dir_list: dir_list,
			        cmd: cmd,
			        compress: compress,
			        pattern: window.pattern,
			        script_list: window.script_list,
			    }, function () {
			    	console.log("sending post...")
			    })
			    .done(function(data) {
			    	displayDesignCharts(data)	  
			    	console.log("pass!")
			    	window.l.stop();
			    })
			    .fail(function() {
			        //$(destId).text("Error: Could not contact server.");
			        //l.stop();
			        console.log("fail!")
			        window.l.stop();
			    });
			}
		}

		function activeMetrics(tmp) {
			window.l = Ladda.create( document.querySelector( '#metrics-name' ) );
			//console.log(window.l.isLoading())
			if (!window.l.isLoading()) {
				window.prev_d = -1;
				window.prev_p = -1;
				window.crnt_d = -1;
				window.crnt_p = -1;
				//window.active_design = undefined;
				var metrics_name = $(tmp).attr('class').split(" ")[2];
				var metrics_catogory = $(tmp).attr('class').split(" ")[0];
				window.active_metrics = metrics_name;
				window.active_pattern = metrics_catogory.toUpperCase();
				$("#design-name").html("Select by design");
				$("#metrics-name").html(metrics_name);
				var dir_list = {{dir_list|safe}};
				var cmd= "{{cmd|safe}}";
				var compress = "{{compress|safe}}";
				$("#qor_charts").css("display","block");
				$("#chart_nav").empty();
				$("#tab-content").empty();
				$('#qor_comp_nav').empty();
				$("#link_nav").empty();
				window.l = Ladda.create( document.querySelector( '#metrics-name' ) );
	 			window.l.start();
				//console.log(window.pattern)
				$.post('display_metrics_chart', {
			        active_metrics: metrics_name,
			        selected_pattern: metrics_catogory.toUpperCase(),
			        dir_list: dir_list,
			        cmd: cmd,
			        compress: compress,
			        pattern: window.pattern,
			        script_list: window.script_list,
			    }, function () {
			    	console.log("sending post...")
			    })
			    .done(function(data) {
			    	window.l.stop();
			    	//console.log(window.pattern)
			    	displayMetricsCharts(data);
			    	console.log("pass!")		    	
			    })
			    .fail(function() {
			        //$(destId).text("Error: Could not contact server.");
			        //l.stop();
			        window.l.stop();
			        console.log("fail!")		        
			    });
			}
		}

		function displayDesignCharts(data) {
			if (window.active_pattern == "None") {
				var active_flag = "active";
			} else {
				var active_flag = "inactive";
			}
		
			//console.log(data["qor_metrics_dict"])
			//console.log(window.active_pattern)
			window.myLineChart = new Array();
	    	$.each(data["qor_metrics_dict"], function(pattern, qor_metrics_list) {
	    		//console.log(qor_metrics_list)
	    		//console.log(pattern)

	    		var metrics_order = data["metrics_order_dict"][pattern];
	    		
    			//add nav   			
    			if (pattern == window.active_pattern) {
    				$("#chart_nav").append("<li role='presentation' class='active'><a href='#"+pattern+"' class='"+pattern+"' aria-controls='"+pattern+"' role='tab' data-toggle='tab' style='color:white;' onclick='activePatternNav(this);''><strong>"+pattern+"</strong></a></li>");
    			} else {
    				$("#chart_nav").append("<li role='presentation' class='"+active_flag+"'><a href='#"+pattern+"' class='"+pattern+"' aria-controls='"+pattern+"' role='tab' data-toggle='tab' style='color:white;' onclick='activePatternNav(this);''><strong>"+pattern+"</strong></a></li>");
    			}
    			
    			//add qor comp panel
    			var qor_comp = "<div class='panel panel-danger pattern_nav "+active_flag+"_nav "+pattern+"_nav'><!-- Default panel contents --><div class='panel-heading'><strong>QoR Compare</strong></div><!-- Table --><table class='table table-striped' style='font-size:12px;'><thead><th>#</th><th id='"+pattern+"_prev_label'>prev</th><th id='"+pattern+"_crnt_label'>crnt</th><th id='"+pattern+"_crnt_label'>pct.(%)</th></thead><tbody id='tb_"+pattern+"' style='font-size:12px;'></tbody></table></div>"
				$("#qor_comp_nav").append(qor_comp);

				$.each(metrics_order, function(i, metrics) {
					tr = "<tr id='"+pattern+"_"+metrics.toLowerCase()+"'><td><strong>"+metrics+"</strong></td><td class='prev'></td><td class='crnt'></td><td class='pct'></td></tr>"
					$("#tb_"+pattern).append(tr);
				})

				//add quick link
				var pattern_nav = "<div class='col-md-1 nav-target pattern_nav "+active_flag+"_nav "+pattern+"_nav' role='complementary'><!-- metrics nav --><nav class='bs-docs-sidebar hidden-print hidden-xs hidden-sm affix' style='top:180px;width:8%;display:block'><ul id='"+pattern+"_metrics_nav' class='nav bs-docs-sidenav metrics-nav'><li><strong>Inner-link</strong></li></ul></br><!-- metrics toggle --><ul id='"+pattern+"_metrics_toggle' class='nav bs-docs-sidenav checkbox-nav'><li style='font-size:14px;''><strong>Check-box</strong></li></ul></div>"
				$("#link_nav").append(pattern_nav)

				$.each(metrics_order, function(i, metrics) {
					li1 = "<li><a href='#"+metrics.toLowerCase()+"'>"+metrics+"</a></li>"
					$("#"+pattern+"_metrics_nav").append(li1);
					li2 = "<li><input type='checkbox' name='"+metrics+"' checked onchange=\"$('."+metrics.toLowerCase()+"').toggle()\">&nbsp;&nbsp;"+metrics+"</input></li>"
					$("#"+pattern+"_metrics_toggle").append(li2);
				})
				$("#"+pattern+"_metrics_nav").append("<li><a class='back-to-top' href='#top'><strong> Back To Top</strong></a></li>");

				if (pattern == window.active_pattern) {
    				tappanel = "<div role='tabpanel' class='tab-pane active' id="+pattern+"></div>";
    			} else {
    				tappanel = "<div role='tabpanel' class='tab-pane "+active_flag+"' id="+pattern+"></div>";
    			}
    			$("#tab-content").append(tappanel);
	    		

				if (active_flag == "active") {	
					if (window.active_pattern == "None") {
						window.active_pattern = pattern;
					}
	    			active_flag = "inactive";
	    		}

	    		//add info panel
	    		var step_match = data["step_match_dict"][pattern]
	    		if (step_match == 1) {
	    			pattern_chart_info = "<div class='alert alert-info' role='alert' id='chart-info'><strong>QoR Metrics (steps match, show qor-metrics in same charts)</strong></div>";
	    			$("#"+pattern).append(pattern_chart_info);

			  		
			  		window.myLineChart[pattern] = new Array();
			  		var chart_data = new Array();
			  		chart_data[pattern] = new Array();
			  		//add canvas for each metrics
				  	$.each(metrics_order, function(i, metrics) {
				  		//chart_data[pattern][metrics] = new Array();
				  		//myLineChart[pattern][metrics] = new Array();
				  		var datasets = new Array();
				  		$.each(qor_metrics_list, function(index, qor_metrics) {
				  			datasets[index] = {
						            label:  data["flow_list"][index]+'/'+data["log_name_list"][index], 
						            fill: false,
						            lineTension: 0.4,
						            backgroundColor: data["color_list"][index],
						            borderColor: data["color_list"][index],
						            borderCapStyle: 'butt',
						            borderDash: [],
						            borderDashOffset: 0.0,
						            borderJoinStyle: 'miter',
						            pointBorderColor: data["color_list"][index],
						            pointBackgroundColor: data["color_list"][index],
						            pointBorderWidth: 1,
						            pointHoverRadius: 3,
						            pointHoverBackgroundColor: "#fff",
						            pointHoverBorderColor: data["color_list"][index],
						            pointHoverBorderWidth: 2,
						            pointRadius: 3,
						            pointHitRadius: 1,
						            data: qor_metrics[metrics],
						            spanGaps: false,
						        }								
						}); // end qor_metrics_list
			  			row = "<div class='row'><div class='col-md-12 "+metrics.toLowerCase()+"' id='"+metrics.toLowerCase()+"'><div class='panel' style='border-color: #39ADB4;'><!-- Default panel contents --><div class='panel-heading' style='background-color: #39ADB4; color: white; font-weight: bold'>"+metrics+"</div><canvas id='myChart_"+pattern+"_"+metrics+"' width='350' height='100'></canvas></div></div></div>"
				  		$("#"+pattern).append(row);

						var ctx = $("#myChart_"+pattern+"_"+metrics).get(0).getContext("2d");
						chart_data[pattern][metrics] = {
						    labels: data["steps_dict"][pattern][0],
						    datasets: datasets,
						};
						//console.log(data["metrics_property_dict"][pattern][metrics]);
						window.myLineChart[pattern][metrics] = new Chart(ctx, {
					    	type: 'line',
					   		data: chart_data[pattern][metrics],
						    options: {
						        scales: {
						            xAxes: [{
						                ticks: {
						                    autoSkip: data["auto_skip_dict"][pattern][0],
						                    display: true,
						                }
						            }],
						            yAxes: [{
						            	type: data["metrics_property_dict"][pattern][metrics][1],
						            }],
						        }
						    }
						});																						

						$("#myChart_"+pattern+"_"+metrics).click(function (evt) {		
					        var activePoints = window.myLineChart[pattern][metrics].getElementAtEvent(evt.originalEvent);							    	
					    	var pointIndex = activePoints[0]._index;
					    	var datasetIndex = activePoints[0]._datasetIndex;					   	
					    	var step_qor_list = data["step_qor_dict"][pattern];
					    	var color_list = data["color_list"];
					    	var metrics_order = data["metrics_order_dict"][pattern];
					    	var qorArray = Array();
					    	var steps_list = data["steps_dict"][pattern];
					    	qorArray = step_qor_list[datasetIndex][pointIndex]; //2:wns, 3:tns, etc
					    	var step_name = steps_list[datasetIndex][pointIndex];
					    	var middle_name = step_name.split(')')[1];
					    	$("#single_name").val(step_name.split(')')[1]);
					    	if($("#second_name").val()==""){
					    		$("#second_name").val($("#first_name").val());
					    	}
					    	$("#first_name").val(step_name.split(')')[1]);	
					    	if (step_name.length > 10) {
					    		step_name = step_name.substr(0,12)
					    	}
					    	
					    	if ($("#"+pattern+"_crnt_label").text() == "crnt") {
					    		//debugger;
					    		if (step_name == 0) {
					    			$("#"+pattern+"_crnt_label").text(pointIndex);	
					    		} else {
					    			$("#"+pattern+"_crnt_label").text(step_name);	
					    		}
					    		$("#"+pattern+"_crnt_label").css("color", color_list[datasetIndex]);	
					    		window.crnt_d = datasetIndex;
					    		window.crnt_p = pointIndex;			    		
					    	} else {
					    		//debugger;
					    		$("#"+pattern+"_prev_label").text($("#"+pattern+"_crnt_label").text());
					    		$("#first_name").val($("#second_name").val());
					    		$("#"+pattern+"_prev_label").css("color",$("#"+pattern+"_crnt_label").css("color"));
					    		if (step_name == 0) {
					    			$("#"+pattern+"_crnt_label").text(pointIndex);	
					    		} else {
					    			$("#"+pattern+"_crnt_label").text(step_name);	
					    			$("#second_name").val(middle_name);
					    		}
					    		$("#"+pattern+"_crnt_label").css("color", color_list[datasetIndex]);
					    		window.prev_d = window.crnt_d;
					    		window.prev_p = window.crnt_p;
					    		window.crnt_d = datasetIndex;
					    		window.crnt_p = pointIndex;
					    	}

					    	$.each(metrics_order, function(i,metrics) {
					    		var crnt = $("#"+pattern+"_"+metrics+">.crnt");
				    			var prev = $("#"+pattern+"_"+metrics+">.prev");
				    			var pct = $("#"+pattern+"_"+metrics+">.pct");

					    		if (crnt.text() == "") {
					    			crnt.text(qorArray[i]);
					    		} else {
					    			prev.text(crnt.text());
					    			crnt.text(qorArray[i]);
					    			var pct_value = (parseFloat(crnt.text()) / parseFloat(prev.text())) * 100 - 100
					    			//console.log(pct_value);
					    			if (pct_value > 10000) {
					    				pct_value = parseInt(pct_value).toExponential(2)
					    				pct.text(pct_value)
					    			} else {
					    				pct.text(pct_value.toFixed(2));
					    			}
					    			
							    	if (parseFloat(crnt.text()) > parseFloat(prev.text())) {
							    		crnt.css("color", "red");
							    		pct.css("color", "red");							    		
							    	} else if (parseFloat(crnt.text()) < parseFloat(prev.text())) {
							    		crnt.css("color", "green");
							    		pct.css("color", "green");
							    	} else {
							    		crnt.css("color", "black");
							    		pct.css("color", "black");
							    	}
					    		};
					    	});
				    	});  							
			  		});	// end metrics_order
	    		} else {
	    			pattern_chart_info = "<div class='alert alert-warning' role='alert'><strong>QoR Metrics (steps mismatch, show qor-metrics in different charts)</strong></div>";		
			  		$("#"+pattern).append(pattern_chart_info);

			  		var myLineChart = new Array();
			  		myLineChart[pattern] = new Array();
			  		var chart_data = new Array();
			  		chart_data[pattern] = new Array();
			  		//add canvas for each metrics
				  	$.each(metrics_order, function(i, metrics) {
				  		chart_data[pattern][metrics] = new Array();
				  		myLineChart[pattern][metrics] = new Array();
				  		$.each(qor_metrics_list, function(index, qor_metrics) {
				  			row = "<div class='row'><div class='col-md-12 "+metrics.toLowerCase()+"' id='"+metrics.toLowerCase()+"'><div class='panel' style='border-color: #39ADB4;'><!-- Default panel contents --><div class='panel-heading' style='background-color: #39ADB4; color: white; font-weight: bold'>"+metrics+"</div><canvas id='myChart_"+pattern+"_"+metrics+"_"+index+"' class='"+index+"' width='350' height='100'></canvas></div></div></div>"
					  		$("#"+pattern).append(row);

							var ctx = $("#myChart_"+pattern+"_"+metrics+"_"+index).get(0).getContext("2d");								
							chart_data[pattern][metrics][index] = {
							    labels: data["steps_dict"][pattern][index],
							    datasets: [			    
							        {
							            label: data["flow_list"][index]+'/'+data["log_name_list"][index], 
							            fill: false,
							            lineTension: 0.4,
							            backgroundColor: data["color_list"][index],
							            borderColor: data["color_list"][index],
							            borderCapStyle: 'butt',
							            borderDash: [],
							            borderDashOffset: 0.0,
							            borderJoinStyle: 'miter',
							            pointBorderColor: data["color_list"][index],
							            pointBackgroundColor: data["color_list"][index],
							            pointBorderWidth: 1,
							            pointHoverRadius: 3,
							            pointHoverBackgroundColor: "#fff",
							            pointHoverBorderColor: data["color_list"][index],
							            pointHoverBorderWidth: 2,
							            pointRadius: 3,
							            pointHitRadius: 1,
							            data: qor_metrics[metrics],
							            spanGaps: false,
							        },
						   	 	]
							};

							myLineChart[pattern][metrics][index] = new Chart(ctx, {
						    	type: 'line',
						   		data: chart_data[pattern][metrics][index],
							    options: {
							        scales: {
							            xAxes: [{
							                ticks: {
							                    autoSkip: data["auto_skip_dict"][pattern][index],
							                    display: true,
							                }
							            }],
							            yAxes: [{
							            	type: data["metrics_property_dict"][pattern][metrics][1],
							            }],
							        }
							    }
							});																						

							$("#myChart_"+pattern+"_"+metrics+"_"+index).click(function (evt) {		
						        var activePoints = myLineChart[pattern][metrics][index].getElementAtEvent(evt.originalEvent);							    	
						    	var pointIndex = activePoints[0]._index;
						    	var datasetIndex = parseInt($("#myChart_"+pattern+"_"+metrics+"_"+index).attr("class"));							    	
						    	var step_qor_list = data["step_qor_dict"][pattern];
						    	var color_list = data["color_list"];
						    	var metrics_order = data["metrics_order_dict"][pattern];
						    	var qorArray = Array();
						    	var steps_list = data["steps_dict"][pattern];
						    	//var pattern = pattern;
						    	qorArray = step_qor_list[datasetIndex][pointIndex]; //2:wns, 3:tns, etc
						    	var step_name = steps_list[datasetIndex][pointIndex];
						    	$("#single_name").val(step_name.split(')')[1]);
						    	$("#first_name").val(step_name.split(')')[1]);		
						    	if (step_name.length > 10) {
						    		step_name = step_name.substr(0,12)
						    	}	    		    	
							    	
						    	if ($("#"+pattern+"_crnt_label").text() == "crnt") {
						    		if (step_name == 0) {
						    			$("#"+pattern+"_crnt_label").text(pointIndex);	
						    		} else {
						    			$("#"+pattern+"_crnt_label").text(step_name);	
						    		}
						    		$("#"+pattern+"_crnt_label").css("color", color_list[datasetIndex]);	
						    		window.crnt_d = datasetIndex;
						    		window.crnt_p = pointIndex;			    		
						    	} else {
						    		$("#"+pattern+"_prev_label").text($("#"+pattern+"_crnt_label").text());
						    		$("#"+pattern+"_prev_label").css("color",$("#"+pattern+"_crnt_label").css("color"));
						    		if (step_name == 0) {
						    			$("#"+pattern+"_crnt_label").text(pointIndex);	
						    		} else {
						    			$("#"+pattern+"_crnt_label").text(step_name);	
						    		}
						    		$("#"+pattern+"_crnt_label").css("color", color_list[datasetIndex]);
						    		window.prev_d = window.crnt_d;
						    		window.prev_p = window.crnt_p;
						    		window.crnt_d = datasetIndex;
						    		window.crnt_p = pointIndex;
						    	}

						    	$.each(metrics_order, function(i,metrics) {
						    		var crnt = $("#"+pattern+"_"+metrics+">.crnt");
					    			var prev = $("#"+pattern+"_"+metrics+">.prev");
					    			var pct = $("#"+pattern+"_"+metrics+">.pct");

						    		if (crnt.text() == "") {
						    			crnt.text(qorArray[i]);
						    		} else {
						    			prev.text(crnt.text());
						    			crnt.text(qorArray[i]);
						    			var pct_value = (parseFloat(crnt.text()) / parseFloat(prev.text())) * 100 - 100
						    			if (pct_value > 10000) {
						    				pct_value = parseInt(pct_value).toExponential(2)
						    				pct.text(pct_value)
						    			} else {
						    				pct.text(pct_value.toFixed(2));
						    			}
						    			
								    	if (parseFloat(crnt.text()) > parseFloat(prev.text())) {
								    		crnt.css("color", "red");
								    		pct.css("color", "red");							    		
								    	} else if (parseFloat(crnt.text()) < parseFloat(prev.text())) {
								    		crnt.css("color", "green");
								    		pct.css("color", "green");
								    	} else {
								    		crnt.css("color", "black");
								    		pct.css("color", "black");
								    	}
						    		};
						    	});
					    	});  															
						}); // end qor_metrics_list
			  		});	// end metrics_order				  		
				};// end step_match if
	    	});

		}

		function displayMetricsCharts(data) {
			metrics = data['metrics'];
	    	selected_pattern = data['selected_pattern'];
	    	console.log(window.pattern)
			//add qor comp panel
			var qor_comp = "<div class='panel panel-danger pattern_nav active_nav "+selected_pattern+"_nav'><!-- Default panel contents --><div class='panel-heading'><strong>QoR Compare</strong></div><!-- Table --><table class='table table-striped' style='font-size:12px;'><thead><th>#</th><th id='"+selected_pattern+"_prev_label'>prev</th><th id='"+selected_pattern+"_crnt_label'>crnt</th><th id='"+selected_pattern+"_crnt_label'>pct.(%)</th></thead><tbody id='tb_"+selected_pattern+"' style='font-size:12px;'></tbody></table></div>"
			$("#qor_comp_nav").append(qor_comp);

			$.each(data['metrics_order_dict'][selected_pattern], function(i, metrics) {
				tr = "<tr id='"+selected_pattern+"_"+metrics.toLowerCase()+"'><td><strong>"+metrics+"</strong></td><td class='prev'></td><td class='crnt'></td><td class='pct'></td></tr>"
				$("#tb_"+selected_pattern).append(tr);
			})

	    	tappanel = "<div role='tabpanel' class='tab-pane active' id="+selected_pattern+"></div>";
			$("#tab-content").append(tappanel);

			$.each(data['design_qor'], function(design_name, qor_dict){	
				if (typeof(qor_dict['qor_metrics_dict'][selected_pattern]) == "undefined") {
					return true
				}
				//add info panel
	    		var step_match = qor_dict['step_match_dict'][selected_pattern]
	    		if (step_match == 1) {
			  		var myLineChart = new Array();
			  		myLineChart[selected_pattern] = new Array();
			  		var chart_data = new Array();
			  		chart_data[selected_pattern] = new Array();
			  		//add canvas for each metrics
			  		var datasets = new Array();
			  		console.log(qor_dict['qor_metrics_dict'][selected_pattern])
			  		// false each, actually handling qor_dict['qor_metrics_dict'][selected_pattern][0], only show selected metrics
			  		$.each(qor_dict['qor_metrics_dict'][selected_pattern], function(index, qor_metrics) {
			  			//console.log(qor_metrics)
			  			datasets[index] = {
					            label:  data["flow_list"][index]+'/'+qor_dict["log_name_list"][index], 
					            fill: false,
					            lineTension: 0.4,
					            backgroundColor: data["color_list"][index],
					            borderColor: data["color_list"][index],
					            borderCapStyle: 'butt',
					            borderDash: [],
					            borderDashOffset: 0.0,
					            borderJoinStyle: 'miter',
					            pointBorderColor: data["color_list"][index],
					            pointBackgroundColor: data["color_list"][index],
					            pointBorderWidth: 1,
					            pointHoverRadius: 3,
					            pointHoverBackgroundColor: "#fff",
					            pointHoverBorderColor: data["color_list"][index],
					            pointHoverBorderWidth: 2,
					            pointRadius: 3,
					            pointHitRadius: 1,
					            data: qor_metrics[metrics],
					            spanGaps: false,
					        }								
					}); // end qor_metrics_list
		  			row = "<div class='row'><div class='col-md-12 "+metrics.toLowerCase()+"' id='"+metrics.toLowerCase()+"'><div class='panel' style='border-color: #39ADB4;'><!-- Default panel contents --><div class='panel-heading' style='background-color: #39ADB4; color: white; font-weight: bold'>"+metrics+" - "+design_name+"</div><canvas id='myChart_"+design_name+"_"+selected_pattern+"_"+metrics+"' width='350' height='100'></canvas></div></div></div>"
			  		$("#"+selected_pattern).append(row);

					var ctx = $("#myChart_"+design_name+"_"+selected_pattern+"_"+metrics).get(0).getContext("2d");
					chart_data[selected_pattern][metrics] = {
					    labels: qor_dict["steps_dict"][selected_pattern][0],
					    datasets: datasets,
					};

					myLineChart[selected_pattern][metrics] = new Chart(ctx, {
				    	type: 'line',
				   		data: chart_data[selected_pattern][metrics],
					    options: {
					        scales: {
					            xAxes: [{
					                ticks: {
					                    autoSkip: qor_dict["auto_skip_dict"][selected_pattern][0],
					                    display: true,
					                }
					            }],
					            yAxes: [{
					            	type: data["metrics_property_dict"][selected_pattern][metrics][1],
					            }],
					        }
					    }
					});																						

					$("#myChart_"+design_name+"_"+selected_pattern+"_"+metrics).click(function (evt) {	
						window.active_design = design_name;	
				        var activePoints = myLineChart[selected_pattern][metrics].getElementAtEvent(evt.originalEvent);							    	
				    	var pointIndex = activePoints[0]._index;
				    	var datasetIndex = activePoints[0]._datasetIndex;
				    	
				    	var step_qor_list = qor_dict["step_qor_dict"][selected_pattern];
				    	var color_list = data["color_list"];
				    	var metrics_order = data["metrics_order_dict"][selected_pattern];

				    	var qorArray = Array();
				    	var steps_list = qor_dict["steps_dict"][selected_pattern];
				    	//var pattern = pattern;
				    	qorArray = step_qor_list[datasetIndex][pointIndex]; //2:wns, 3:tns, etc
				    	var step_name = steps_list[datasetIndex][pointIndex];
				    	$("#first_name").val(step_name.split(')')[1]);
				    	$("#single_name").val(step_name.split(')')[1]);
				    	if (step_name.length > 10) {
				    		step_name = step_name.substr(0,12)
				    	}			    		    	
				    	
				    	if ($("#"+selected_pattern+"_crnt_label").text() == "crnt") {
				    		if (step_name == 0) {
				    			$("#"+selected_pattern+"_crnt_label").text(pointIndex);	
				    		} else {
				    			$("#"+selected_pattern+"_crnt_label").text(step_name);	
				    		}
				    		$("#"+selected_pattern+"_crnt_label").css("color", color_list[datasetIndex]);	
				    		window.crnt_d = datasetIndex;
				    		window.crnt_p = pointIndex;			    		
				    	} else {
				    		$("#"+selected_pattern+"_prev_label").text($("#"+selected_pattern+"_crnt_label").text());
				    		$("#"+selected_pattern+"_prev_label").css("color",$("#"+selected_pattern+"_crnt_label").css("color"));
				    		if (step_name == 0) {
				    			$("#"+selected_pattern+"_crnt_label").text(pointIndex);	
				    		} else {
				    			$("#"+selected_pattern+"_crnt_label").text(step_name);	
				    		}
				    		$("#"+selected_pattern+"_crnt_label").css("color", color_list[datasetIndex]);
				    		window.prev_d = window.crnt_d;
				    		window.prev_p = window.crnt_p;
				    		window.crnt_d = datasetIndex;
				    		window.crnt_p = pointIndex;
				    	}

				    	$.each(metrics_order, function(i,metrics) {
				    		var crnt = $("#"+selected_pattern+"_"+metrics+">.crnt");
			    			var prev = $("#"+selected_pattern+"_"+metrics+">.prev");
			    			var pct = $("#"+selected_pattern+"_"+metrics+">.pct");

				    		if (crnt.text() == "") {
				    			crnt.text(qorArray[i]);
				    		} else {
				    			prev.text(crnt.text());
				    			crnt.text(qorArray[i]);
				    			var pct_value = (parseFloat(crnt.text()) / parseFloat(prev.text())) * 100 - 100
				    			if (pct_value > 10000) {
				    				pct_value = parseInt(pct_value).toExponential(2)
				    				pct.text(pct_value)
				    			} else {
				    				pct.text(pct_value.toFixed(2));
				    			}				    			
						    	if (parseFloat(crnt.text()) > parseFloat(prev.text())) {
						    		crnt.css("color", "red");
						    		pct.css("color", "red");							    		
						    	} else if (parseFloat(crnt.text()) < parseFloat(prev.text())) {
						    		crnt.css("color", "green");
						    		pct.css("color", "green");
						    	} else {
						    		crnt.css("color", "black");
						    		pct.css("color", "black");
						    	}
				    		};
				    	});
			    	});  							
	    		} else {
	    			//pattern_chart_info = "<div class='alert alert-warning' role='alert'><strong>QoR Metrics (steps mismatch, show qor-metrics in different charts)</strong></div>";		
			  		//$("#"+pattern).append(pattern_chart_info);

			  		var myLineChart = new Array();
			  		myLineChart[selected_pattern] = new Array();
			  		var chart_data = new Array();
			  		chart_data[selected_pattern] = new Array();
			  		//add canvas for each metrics
			  		chart_data[selected_pattern][metrics] = new Array();
			  		myLineChart[selected_pattern][metrics] = new Array();
			  		$.each(qor_dict['qor_metrics_dict'][selected_pattern], function(index, qor_metrics) {
			  			row = "<div class='row'><div class='col-md-12 "+metrics.toLowerCase()+"' id='"+metrics.toLowerCase()+"'><div class='panel' style='border-color: #39ADB4;'><!-- Default panel contents --><div class='panel-heading' style='background-color: #39ADB4; color: white; font-weight: bold'>"+metrics+" - "+design_name+"</div><canvas id='myChart_"+design_name+"_"+selected_pattern+"_"+metrics+"_"+index+"' class='"+index+"' width='350' height='100'></canvas></div></div></div>"
				  		$("#"+selected_pattern).append(row);

						var ctx = $("#myChart_"+design_name+"_"+selected_pattern+"_"+metrics+"_"+index).get(0).getContext("2d");								
						chart_data[selected_pattern][metrics][index] = {
						    labels: qor_dict["steps_dict"][selected_pattern][index],
						    datasets: [			    
						        {
						            label: data["flow_list"][index]+'/'+qor_dict["log_name_list"][index], 
						            fill: false,
						            lineTension: 0.4,
						            backgroundColor: data["color_list"][index],
						            borderColor: data["color_list"][index],
						            borderCapStyle: 'butt',
						            borderDash: [],
						            borderDashOffset: 0.0,
						            borderJoinStyle: 'miter',
						            pointBorderColor: data["color_list"][index],
						            pointBackgroundColor: data["color_list"][index],
						            pointBorderWidth: 1,
						            pointHoverRadius: 3,
						            pointHoverBackgroundColor: "#fff",
						            pointHoverBorderColor: data["color_list"][index],
						            pointHoverBorderWidth: 2,
						            pointRadius: 3,
						            pointHitRadius: 1,
						            data: qor_metrics[metrics],
						            spanGaps: false,
						        },
					   	 	]
						};

						myLineChart[selected_pattern][metrics][index] = new Chart(ctx, {
					    	type: 'line',
					   		data: chart_data[selected_pattern][metrics][index],
						    options: {
						        scales: {
						            xAxes: [{
						                ticks: {
						                    autoSkip: qor_dict["auto_skip_dict"][selected_pattern][index],
						                    display: true,
						                }
						            }],
						            yAxes: [{
						            	type: data["metrics_property_dict"][selected_pattern][metrics][1],
						            }],
						        }
						    }
						});																						

						$("#myChart_"+design_name+"_"+selected_pattern+"_"+metrics+"_"+index).click(function (evt) {	
							window.active_design = design_name;		
					        var activePoints = myLineChart[selected_pattern][metrics][index].getElementAtEvent(evt.originalEvent);							    	
					    	var pointIndex = activePoints[0]._index;
					    	var datasetIndex = parseInt($("#myChart_"+selected_pattern+"_"+metrics+"_"+index).attr("class"));							    	
					    	var step_qor_list = qor_dict["step_qor_dict"][selected_pattern];
					    	var color_list = data["color_list"];
					    	var metrics_order = data["metrics_order_dict"][selected_pattern];
					    	var qorArray = Array();
					    	var steps_list = qor_dict["steps_dict"][selected_pattern];
					    	//var pattern = pattern;
					    	qorArray = step_qor_list[datasetIndex][pointIndex]; //2:wns, 3:tns, etc
					    	var step_name = steps_list[datasetIndex][pointIndex];
					    	$("#first_name").val(step_name.split(')')[1]);	
					    	$("#single_name").val(step_name.split(')')[1]);
					    	if (step_name.length > 10) {
					    		step_name = step_name.substr(0,12)
					    	}		    		    	
					    	
					    	if ($("#"+selected_pattern+"_crnt_label").text() == "crnt") {
					    		if (step_name == 0) {
					    			$("#"+selected_pattern+"_crnt_label").text(pointIndex);	
					    		} else {
					    			$("#"+selected_pattern+"_crnt_label").text(step_name);	
					    		}
					    		$("#"+selected_pattern+"_crnt_label").css("color", color_list[datasetIndex]);	
					    		window.crnt_d = datasetIndex;
					    		window.crnt_p = pointIndex;			    		
					    	} else {
					    		$("#"+selected_pattern+"_prev_label").text($("#"+selected_pattern+"_crnt_label").text());
					    		$("#"+selected_pattern+"_prev_label").css("color",$("#"+selected_pattern+"_crnt_label").css("color"));
					    		if (step_name == 0) {
					    			$("#"+selected_pattern+"_crnt_label").text(pointIndex);	
					    		} else {
					    			$("#"+selected_pattern+"_crnt_label").text(step_name);	
					    		}
					    		$("#"+selected_pattern+"_crnt_label").css("color", color_list[datasetIndex]);
					    		window.prev_d = window.crnt_d;
					    		window.prev_p = window.crnt_p;
					    		window.crnt_d = datasetIndex;
					    		window.crnt_p = pointIndex;
					    	}

					    	$.each(metrics_order, function(i,metrics) {
					    		var crnt = $("#"+selected_pattern+"_"+metrics+">.crnt");
				    			var prev = $("#"+selected_pattern+"_"+metrics+">.prev");
				    			var pct = $("#"+selected_pattern+"_"+metrics+">.pct");

					    		if (crnt.text() == "") {
					    			crnt.text(qorArray[i]);
					    		} else {
					    			prev.text(crnt.text());
					    			crnt.text(qorArray[i]);
					    			var pct_value = (parseFloat(crnt.text()) / parseFloat(prev.text())) * 100 - 100
					    			if (pct_value > 10000) {
					    				pct_value = parseInt(pct_value).toExponential(2)
					    				pct.text(pct_value)
					    			} else {
					    				pct.text(pct_value.toFixed(2));
					    			}
							    			
							    	if (parseFloat(crnt.text()) > parseFloat(prev.text())) {
							    		crnt.css("color", "red");
							    		pct.css("color", "red");							    		
							    	} else if (parseFloat(crnt.text()) < parseFloat(prev.text())) {
							    		crnt.css("color", "green");
							    		pct.css("color", "green");
							    	} else {
							    		crnt.css("color", "black");
							    		pct.css("color", "black");
							    	}
					    		};
					    	});
				    	});  						
					}); // end qor_metrics_list			  		
				}; // end step_match if
			})	    	
		}

		function activeModal() {
			var url = "{{url|safe}}";
			if ($("#design-name>.ladda-label").length == 1) {
				var active_design = $("#design-name>.ladda-label")[0].outerText
			} else {
				var active_design = window.active_design
			}

			if ($("#metrics-name>.ladda-label").length == 1) {
				var active_metrics = $("#metrics-name>.ladda-label")[0].outerText
			} else {
				var active_metrics = undefined
			}

			$("#url-link").val(url+"&active_design="+active_design+"&active_metrics="+active_metrics+"&active_pattern="+window.active_pattern+"&prev_d="+window.prev_d+"&prev_p="+window.prev_p+"&crnt_d="+window.crnt_d+"&crnt_p="+window.crnt_p);				
			$("#myModal").modal();
			$("#url-link").select();
			$("#url-link").focus();
		}

		function activePatternNav(tmp) {			
			var selected_pattern = $(tmp).attr('class').split(" ")[0];
			window.active_pattern = selected_pattern;
			$(".pattern_nav").addClass('inactive_nav');
			$(".pattern_nav").removeClass('active_nav');
			$("."+selected_pattern+"_nav").removeClass('inactive_nav');
			$("."+selected_pattern+"_nav").addClass('active_nav');
		}

	</script>

    <nav class="navbar navbar-inverse navbar-fixed-top">

	<div class="container" style="margin-left:160px;">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#" style="color:#fff;">QoR Analyzer Web</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
          	<li><a href="{{ url_for('index') }}">Home</a></li>
            <li class="dropdown active">
	          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">DashBoard<span class="caret"></span></a>
	          <ul class="dropdown-menu">
	          	<li class="dropdown-header">Select a core OPT stage</li>
	            <li><a href="{{ url_for('qor_profile_popt', mode='flow', compress=compress, input_list=dir_list, pattern=pattern, script_list=script_list) }}">Popt QoR Profiler</a></li>
	            <li><a href="{{ url_for('qor_profile_copt', mode='flow', compress=compress, input_list=dir_list, pattern=pattern, script_list=script_list) }}">Copt QoR Profiler</a></li>	   
	            <li><a href="{{ url_for('qor_profile_ropt', mode='flow', compress=compress, input_list=dir_list, pattern=pattern, script_list=script_list) }}">Ropt QoR Profiler</a></li>       
	            <li><a href="{{ url_for('qor_profile_fopt', mode='flow', compress=compress, input_list=dir_list, pattern=pattern, script_list=script_list) }}">Fopt QoR Profiler</a></li>
	          </ul>
	        </li>
			<li><a href="#">About</a></li>
		  </ul>

        </div><!--/.nav-collapse -->
  	</div>
    </nav>  

	<div class="container bs-docs-container" role="main" style="width:1700px;margin-left:15px;">
		<div class="row" style="width:1700px;">
			<div id="link_nav" class="col-md-1 nav-target" role="complementary">
			</div> 
				<!-- col-3 -->
			<div class="col-md-9" role="main">
				<!-- Main jumbotron for a primary marketing message or call to action -->
				<div class="alert alert-success alert-dismissible" role="alert">
					<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			    	<strong>QoR Analyzer: data loaded successfully!! (Will adapt "0" qor value to "0.00001" to avoid logarithmic exception)</strong>
			  	</div>

			  	<h4 style="margin-bottom:18px;">
			  	<span class="label label-primary">Mode: {{mode}}</span>
			  	{% if compress==0 %}
			  		<span class="label label-primary">Compress: no</span>
			  	{% else %}
			  		<span class="label label-primary">Compress: yes</span>
			  	{% endif %}
			  	<span class="label label-primary">Stage: nw{{cmd}}</span>
			  	</h4>
			  	{% set color_index = 0 %}
			  	{% for dir in dir_list%}
			  	<h4 style="margin-bottom:18px;">
			  	<span class="label label-info" style="background-color: {{color_list[color_index]|safe}}">{{dir}}</span>
			  	</h4>
			  	{% set color_index = color_index + 1 %}
			  	{% endfor %}
			  	{% if script_list %}
			  	{% set pattern_index = 1 %}
			  	<h4 style="margin-bottom:18px;">
			  	<span class="label label-primary">Non-default pattern:</span>
			  	</h4>
			  	{% for script in script_list%}
			  	<h4 style="margin-bottom:18px;">
			  	<span class="label label-primary">USER{{pattern_index}}: </span>
			  	<span class="label label-primary" style="margin-left: 5px;">{{script}}</span>
			  	</h4>
			  	{% set pattern_index = pattern_index + 1 %}
			  	{% endfor %}
			  	{% endif %}
			  	<h4 style="margin-bottom:18px;">
				<!-- Modal -->
				<div style="top:252px;" class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				  <div class="modal-dialog">
				    <div class="modal-content">
				      <div class="modal-header">
				        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
				        <h4 class="modal-title" id="myModalLabel">Share this link to others</h4>
				      </div>
				      <div class="modal-body">
						    <input id="url-link" type="text" value="" style="width:100%;display:block;margin-bottom:10px;font-size:14px;padding:8px;"></input>
						    <span style="font-size:12px;">Just press "Ctrl + C"</span>
				      </div>
				    </div>
				  </div>
				</div>
				</h4>
				<!-- Split button -->
				<div class="row">
					<!--select by design-->
					<div class="col-md-12">
					<div class="btn-group" style="margin-bottom: 18px;display:table-cell;">
					  <button id="design-name" type="button" class="btn btn-warning ladda-button" data-style="expand-right">Select by design</button>
					  <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;">
					    <span class="caret" style="margin-top: 4px"></span>
					    <span class="sr-only">Toggle Dropdown</span>
					  </button>
					  <ul class="dropdown-menu">
					  	{% for design in design_list %}
					    <li class="design {{design}}" onclick="activeDesign(this);"><a href="#">{{design}}</a></li>
					    {% endfor %}
					  </ul>
					</div>
					<div style="padding-left: 10px;padding-right:10px;display:table-cell;">
				  	<h4 style="margin-bottom:18px;">
				  	<span class="label label-primary">OR</span>
				  	</h4>
				  	</div>
				  	<!--select by metrics-->

					<div class="btn-group" style="margin-bottom: 18px;display:table-cell;">
					  <button id="metrics-name" type="button" class="btn btn-warning ladda-button" data-style="expand-right">Select by metrics</button>
					  <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;">
					    <span class="caret" style="margin-top: 4px"></span>
					    <span class="sr-only">Toggle Dropdown</span>
					  </button>
					  <ul class="dropdown-menu">
					  	{% if pattern|string() == 'USER' %}
					  		{% set pattern_index = 1 %}
					  		{% for script in script_list%}
								<li class="dropdown-header">USER{{pattern_index}} metrics</li>
								{% set index = pattern_index|string() %}
								{% for metrics in metrics_order_dict["USER"+index] %}
							    	<li class="user{{index}} metrics {{metrics}}" onclick="activeMetrics(this);"><a href="#">{{metrics}}</a></li>
							    {% endfor %}
						    {% set pattern_index = pattern_index + 1 %}
			  				{% endfor %}
						{% endif %}
					  	{% if cmd|string() == 'popt' %}
							<li class="dropdown-header">PREROUTE metrics</li>
							{% for metrics in metrics_order_dict["PREROUTE"] %}
						    	<li class="preroute metrics {{metrics}}" onclick="activeMetrics(this);"><a href="#">{{metrics}}</a></li>
						    {% endfor %}
						{% elif cmd|string() == 'copt' %}
							<li class="dropdown-header">PREROUTE metrics</li>
							{% for metrics in metrics_order_dict["PREROUTE"] %}
						    	<li class="preroute metrics {{metrics}}" onclick="activeMetrics(this);"><a href="#">{{metrics}}</a></li>
						    {% endfor %}	
						    <li role="separator" class="divider"></li>					
							<li class="dropdown-header">GROPT metrics</li>            
							{% for metrics in metrics_order_dict["GROPT"] %}
						    	<li class="gropt metrics {{metrics}}" onclick="activeMetrics(this);"><a href="#">{{metrics}}</a></li>
						    {% endfor %}
						{% elif cmd|string() == 'ropt' %}
							<li class="dropdown-header">ROPT metrics</li>            
							{% for metrics in metrics_order_dict["ROPT"] %}
						    	<li class="ropt metrics {{metrics}}" onclick="activeMetrics(this);"><a href="#">{{metrics}}</a></li>
						    {% endfor %}
						{% elif cmd|string() == 'fopt' %}
							<li class="dropdown-header">FOPT metrics</li>            
							{% for metrics in metrics_order_dict["ROPT"] %}
						    	<li class="ropt metrics {{metrics}}" onclick="activeMetrics(this);"><a href="#">{{metrics}}</a></li>
						    {% endfor %}						    
						{% endif %}
					  </ul>
					</div>
					<form role="search" action="/jump_profile" method=post style="margin-top: 1em">
					<div id="show_name" class="btn-group" style="margin-bottom: 18px;display:none;width: 1600px;">
						<div style="float: left;">
						<div class="input-group-addon" style="display:table-cell;border-right: 0;float: left;width: 150px;height: 34px;line-height: 1.5">Analysis Single Step</div>
						<input style="width:150px;display:table-cell;float: left;border-radius: 0px;" id="single_name" name="single_name" type="text" class="form-control" placeholder="Single Name">
						<div class="input-group-btn" style="display:table-cell;float: left;"><button type="submit" id="enter_btn" class="btn btn-primary" data-style="expand-right" onclick="activeChange(this);">Start!</button></div>
						</div>
						<div style="float: left;width: 800px;padding-left: 30px;">
						<div class="input-group-addon" style="display:table-cell;border-right: 0;float: left;width: 140px;height: 34px;line-height: 1.5">Analysis Steps</div>
						<button type="button" class="btn btn-warn" style="width:70px;border-radius:0px;float: left;">Base</button>
						<input style="width:150px;display:table-cell;float: left;border-radius: 0px;" id="first_name" name="first_name" type="text" class="form-control" placeholder="base Name">
						<button type="button" class="btn btn-warn" style="width:80px;border-radius:0px;float: left;">Compare</button>
						<input style="width:150px;border-radius: 0px;display:table-cell;float: left;" class="form-control" type="text" id="second_name" name="second_name" placeholder="Compare Name">
						<div class="input-group-btn" style="display:table-cell;float: left;"><button type="submit" id="enter2_btn" class="btn btn-primary" data-style="expand-right" onclick="activeChange1(this);">Start!</button></div>
						</div>
						<input style="width:300px;margin-bottom:2px;display:none;" class="form-control" type="text" id="first_dir" name="first_dir">
						<input style="width:300px;margin-bottom:2px;display:none;" class="form-control" type="text" id="mode" name="mode">
						<input style="width:300px;margin-bottom:2px;display:none;" class="form-control" type="text" id="first_pattern" name="first_pattern">
						<input style="width:300px;margin-bottom:2px;display:none;" class="form-control" type="text" id="first_stage" name="first_stage">
					</div>
					</form>
					</div>
				</div>
			


				<div id="qor_charts" class="qor_charts">
					<!-- Nav tabs -->
					<ul id="chart_nav" class="nav nav-pills" role="tablist" style="margin-bottom: 10px;">
					</ul>

					<div class="tab-content" id="tab-content">
						
			  		</div>

				</div>	
			</div>
			<!-- col-9 -->
			<div class="col-md-2" role="complementary" style="padding-left: 0px;">
				<nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" style="top:252px;width:400px;">
				  	<h4 style="margin-bottom:18px;">
					<!-- Button trigger modal -->
					<button type="button" class="btn btn-success btn-xs" onclick="activeModal();">
					  <span class="glyphicon glyphicon-share"></span><strong>Share</strong>
					</button>

					</h4>
				<ul id='qor_comp_nav' class="nav bs-docs-sidenav">

				</ul>
				</nav>
			</div> 
			<!-- col-3 -->
		</div>
	</div>
	<nav id="nav-footer" class="navbar navbar-inverse navbar-fixed-bottom">
	    <div class="navbar-inner navbar-content-center" style="text-align:center;">
	        <p class="text-muted credit" style="margin:5px 0 0 0;color:white">Chrome/Firefox browsers with 1600x1200+ resolution are suggested</p>
	        <p class="text-muted credit" style="margin:0px;color:white">Contact <a href="mailto:phyan@synopsys.com">Leo Yan</a> if needed</p>
	    </div>
	</nav>
	</body>
</html>
