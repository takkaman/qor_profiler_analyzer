<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="{{ url_for('static', filename='jquery/1.11.1/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='libs/jqueryui/jquery.ui-1.9.0.min.js') }}"></script>
    <!-- 引入 Bootstrap -->

    <!--
        <link href="/u/phyan/workspace/python/qor_analyzer/libs/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
        -->
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap/js/bootstrap.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap/js/Chart_v2.6.js') }}"></script>
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='bootstrap/js/analysis.js') }}"></script> -->

    <style type="text/css" src="{{ url_for('static', filename='bootstrap/css/bootstrap.css') }}"></style>



    <meta name="description" content="">
    <meta name="author" content="">

    <title>QoR Analyzer Web ^_^</title>

    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='bootstrap/3.3.5/css/bootstrap.min.css') }}" rel="stylesheet">
    <!-- Bootstrap theme -->
    <!--<link href="{{ url_for('static', filename='bootstrap/css/bootstrap-theme.min.css') }}" rel="stylesheet">-->
    <!-- Custom styles for this template -->
    <link href="{{ url_for('static', filename='bootstrap/css/theme.css') }}" rel="stylesheet">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/bootstrap-table-master/src/bootstrap-table.css') }}">
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap/bootstrap-table-master/src/bootstrap-table.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/ladda-bootstrap-master/dist/ladda-themeless.min.css') }}">
    <script src="{{ url_for('static', filename='bootstrap/ladda-bootstrap-master/dist/spin.min.js') }}"></script>
    <script src="{{ url_for('static', filename='bootstrap/ladda-bootstrap-master/dist/ladda.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap/bootstrap-table-master/src/bootstrap-table-export.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap/bootstrap-table-master/src/tableExport.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap/bootstrap-multiselect-master/js/bootstrap-multiselect.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/bootstrap-multiselect-master/css/bootstrap-multiselect.css') }}" type="text/css"/>


</head>

<!--<body role="document" style="background-color: #efefef;">-->
<body role="document" style="background-image: url('{{ url_for('static', filename='bootstrap/images/qor_analyzer.jpg') }}'); background-size:100% 100%;">
<style>
    .navbar .nav>li>a{padding: 15px 10px 15px 10px}
    .gain-loss-display {display: none;}
    .btn-default {width:52px; height:34px}
    .panel-heading{background-color: #54c7ce; color: white; font-weight: bold}
</style>
<script type="text/javascript">
    /**
 * Created by qingzhuo on 6/20/2017.
 */
    function switchMetrics(e) {
        var metrics = $(e).attr('id');
        console.log(metrics);
        $("#sqb-switch").text(metrics);
        $(".sqb-summary").css("display","none");
        $(".sqb-chart").css("display","block");
        window.bs_data = [];
        window.selected_metrics = metrics;
        $.each(window.step_qor_info[metrics], function(design_name, value) {
            if (value == "null") {
                return true;
            }
            $.each(value, function(index, qor_data_list) {
                //console.log(qor_data_list[0])
                var dir = encodeURIComponent($("#sqb1-flow-dir").val());
                var pattern = $("#pattern").text().trim();
                console.log("stage is"+stage);
                // var stage = $("#stage").text().trim().toLowerCase().substring(2, 6);
                var stage = "{{stage|safe}}";
                var reg = /\d+/;
                var prevp = qor_data_list[0].match(reg);
                var crntp = qor_data_list[2].match(reg);
                var url = window.location.pathname.split('/')
                url =url.slice(0,url.length-1).join('/')
                var mt = "http://"+window.location.host+url+"/profile_flow" + "?mode=flow&pattern=all&compress=1&input_list=" + dir +"&cmd=" + stage +"&active_design=" + design_name
                    +"&active_metrics=undefined&active_pattern=" + pattern + "&prev_d=0&prev_p=" + prevp + "&crnt_d=0&crnt_p="+ crntp ;
                var data_ele = {
                    "design_name": design_name,
                    "step_name": qor_data_list[2],
                    "step_val": qor_data_list[3],
                    "base_name": qor_data_list[0],
                    "base_val": qor_data_list[1],
                    "pct": qor_data_list[4],
                    "link": "<a href='"+ mt +"'>View</a>"
                }
                window.bs_data.push(data_ele)
                //$("#sqb_bs_table").append(trHTML)
            })
            //console.log(design_name)
            //console.log(value)
        });

        var distri_list = getDistriCount(window.bs_data);
        console.log(distri_list);

        myBarChart.config.data.datasets[0].data = distri_list;
        myBarChart.update();
        $('#sqb_bs_table').bootstrapTable('destroy').bootstrapTable({
            //toolbar: '#toolbar',                //工具按钮用哪个容器
            striped: true,                      //是否显示行间隔色
            //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true,                   //是否显示分页（*）
            sortable: true,                     //是否启用排序
            //sortOrder: "asc",                   //排序方式
            //queryParams: oTableInit.queryParams,//传递参数（*）
            //sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageNumber:1,                       //初始化加载第一页，默认第一页
            pageSize: 50,                       //每页的记录行数（*）
            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
            search: true,
            showColumns: true,
            showExport: true,
            //strictSearch: true,
            //clickToSelect: true,                //是否启用点击选中行
            //height: 460,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            //uniqueId: "id",                     //每一行的唯一标识，一般为主键列
            //cardView: false,                    //是否显示详细视图
            //detailView: false,                   //是否显示父子表
            columns: [{
                field: 'design_name',
                title: 'Design Name',
                sortable: true
            },{
                field: 'base_name',
                title: 'Base Step',
                sortable: true
            }, {
                field: 'base_val',
                title: 'Base Value',
                sortable: true
            },  {
                field: 'step_name',
                title: 'Step Name',
                sortable: true
            }, {
                field: 'step_val',
                title: 'Step Value',
                sortable: true
            }, {
                field: 'pct',
                title: 'Percentage (%)',
                sortable: true
            },{
                field: 'link',
                title: 'Profile link',
                sortable: true,

            }
            ],
            data: window.bs_data
        });
    }

    function switchNewMetrics(e){
        $(".sqb-chart").css("display","none");
        var summary = [];
        for(key in  window.step_qor_info) {
            summary.push([key]);
        }
//                console.log(summary);
        summary_data = [];
        $.each(summary,function(index,dvalue){
            window.bs_data = [];
            $.each(window.step_qor_info[dvalue], function(design_name, value) {
                if (value == "null") {
                    return true;
                }
                $.each(value, function(index, qor_data_list) {
                    var data_ele = {
                        "pct": qor_data_list[4]
                    };
                    window.bs_data.push(data_ele);
                })
            });
            var distri_list = getDistriCount(window.bs_data);
            //console.log(distri_list);
            summary_data.push(distri_list);
        });
        $(".sqb-summary").empty();
        $.each(summary,function(index,svalue){
            var newdiv = "<div class='col-md-3' style='padding:5px;'> <div class='panel' style='border-color: #54c7ce;'>"
                +" <div class='panel-heading'>"+svalue+"</div> <canvas id='canvas"+index+"' width='300' height='300'></canvas></div> </div>";
            $(".sqb-summary").append(newdiv);
            var ctx = $("#canvas"+index).get(0).getContext("2d");
            var data3 = {
                labels: ["-100%+", "-100%", "(-100%~-80%]", "(-80%+~-50%]","(-50%~-20%]", "(-20%~-10%]", "(-10%~-0%)", "0%", "(+0%~+10%)", "[+10%~+20%)", "[+20%~+50%)", "[+50%~+80%)", "[+80%~+100%)", "+100%", "+100%+"],
                datasets: [
                    {
                        label: "qor distribution",
                        backgroundColor: [
                            'rgba(153, 204, 51, 1)',
                            'rgba(153, 204, 51, 0.9)',
                            'rgba(153, 204, 51, 0.8)',
                            'rgba(153, 204, 51, 0.6)',
                            'rgba(153, 204, 51, 0.5)',
                            'rgba(153, 204, 51, 0.3)',
                            'rgba(153, 204, 51, 0.1)',
                            'rgba(119, 119, 119, 0.2)',
                            'rgba(255, 99, 132, 0.1)',
                            'rgba(255, 99, 132, 0.3)',
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(255, 99, 132, 0.9)',
                            'rgba(255, 99, 132, 1)',
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(119, 119, 119, 0.8)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                        ],
                        borderWidth: 1,
                        data: [65, 59, 80, 81, 56, 55, 40, 22, 45, 68, 34, 67 ,67, 23, 88],
                    },
                ],
            };
        
            window[svalue] = new Chart(ctx, {
                type: 'bar',
                data: data3,
                options: {
                    showAllTooltips: true,
                    legend: {
                        display: false,
                    },
                    tooltips: {
                                callbacks: {
                                    label: function(tooltipItem, data) {
                                        if (window.display_designs.length > 0) {
                                            return window.display_designs;
                                        } else {
                                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                                            var tooltipLabel = data.labels[tooltipItem.index];
                                            var tooltipData = allData[tooltipItem.index];
                                            var total = 0;
                                            for (var i in allData) {
                                                total += allData[i];
                                            }
                                            var tooltipPercentage = Math.round((tooltipData / total) * 100);
                                            // return tooltipData + ' (' + tooltipPercentage + '%)';
                                        }
                                    },
                                }                         
                            }, 
                    scales: {
                        xAxes: [{
                            display:true,
                            ticks: {
                            callback: function(dataLabel, index) {
                                return index == 7 ? dataLabel : '';
                            }    
                            }
                        }],
                        yAxes: [{
                            stacked: true
                        }]
                    }
                }

            });
//            var myDoughnutChart0 = new Chart(ctx, {
//                type: 'doughnut',
//                data: {
//                    labels: [ "Improve", "Neutral", "Degrade"],
//                    datasets: [
//                        {
//                            label: "qor distribution",
//                            backgroundColor: [
//                                'rgba(153, 204, 51, 1)',
//                                'rgba(119, 119, 119, 0.2)',
//                                'rgba(255, 99, 132, 1)'
//                            ],
//                            borderColor: [
//                                'rgba(75, 192, 192, 1)',
//                                'rgba(119, 119, 119, 0.8)',
//                                'rgba(255,99,132,1)'
//                            ],
//                            borderWidth: 1,
//                            data: [65, 59, 80]
//                        },
//                    ],
//                },
//                  options: {
//                      legend: {
//                          labels: {
//                              boxWidth: 15,
//                          }
//                      },
//                  },
////            });
            window[svalue].config.data.datasets[0].data = summary_data[index];
            window[svalue].update();
        });
       
                // $('#sqb-design-select').multiselect({
                //         includeSelectAllOption: true,
                //         buttonWidth: '200px',
                //         onSelectAll: function() {
                //             $.each(window.all_select,function(index,value){
                //                 window.selected_designs.push(value);
                //                 $.each(summary,function(index,value){
                //                     window.selected_metrics = value;
                //                     window[value].update();
                //                 });
                //             })
                //         },
                //         onDeselectAll:function(){
                //             window.selected_designs = [];
                //             $.each(summary,function(index,value){
                //                     window.selected_metrics = value;
                //                     window[value].update();
                //                 });
                //         },
                //         onChange: function(option, checked, select) {
                //             design_name = $(option).val();
                //             if (checked == true) {
                //                 window.selected_designs.push(design_name);
                //                  $.each(summary,function(index,value){
                //                     window.selected_metrics = value;
                //                     window[value].update();
                //                 });
                //                 // myBarChart.update();
                //             }

                //             if (checked == false) {
                //                 pos = jQuery.inArray(design_name, window.selected_designs);
                //                 window.selected_designs.splice(pos,1);
                //                  $.each(summary,function(index,value){
                //                     window.selected_metrics = value;
                //                     window[value].update();
                //                 });
                //             }                           
                //             //console.log($(option).val() + $(option).selected());
                //         }
                //     });

        $("#sqb-switch").text("SUMMARY");
        $(".sqb-summary").css("display","block");
    }

    function switchStepName(e){
        var listname = $(e).attr('id');
        $("#sqbstep-name-switch").html(listname);
        $("#sqb1-step-name").val(listname);
    }


    function switchBaseName(e,index1){
        var listname = $(e).attr('id');
        mark = $("#sqc-base-name").val();
        if(listname!=mark){
            $("#sqccmp-name-switch-li").empty();
            $.each(window.steps_list_dict, function(name_list, step) {
                if(name_list == $("#cpattern").text().trim()){
                    $.each(step,function(num,dict){
                        if(num>=index1){
                            var li = "<li><a href='#' id='"+dict+"'onclick='switchCmpName(this,"+num+");'>"+dict+"</a></li>"
                            $("#sqccmp-name-switch-li").append(li);
                        }
                    })
                }
                mark = listname;
            })
        }
        $("#sqcstep-name-switch").html(listname);
        $("#sqc-base-name").val(listname);
    }

    function switchCmpName(e,index2){
        var listname = $(e).attr('id');
        mark = $("#sqc-comp-name").val();
        if(listname!=mark){
            $("#sqcstep-name-switch-li").empty();
            $.each(window.steps_list_dict, function(name_list, step) {
                if(name_list == $("#cpattern").text().trim()){
                    $.each(step,function(num,dict){
                        if(num<=index2){
                            var li = "<li><a href='#' id='"+dict+"'onclick='switchBaseName(this,"+num+");'>"+dict+"</a></li>"
                            $("#sqcstep-name-switch-li").append(li);
                        }
                    })
                }
                mark = listname;
            })
        }
        $("#sqccmp-name-switch").html(listname);
        $("#sqc-comp-name").val(listname);
    }

    function switchSqcMetrics(e) {
        var metrics = $(e).attr('id');
        console.log(metrics);
        $("#sqc-switch").text(metrics);
        $(".sqc-summary").css("display","none");
        $(".sqc-chart").css("display","block");
        window.bs_data = [];
        window.selected_metrics = metrics;
        $.each(window.step_qor_info[metrics], function(design_name, value) {
            if (value == "null") {
                return true;
            }
            $.each(value, function(index, qor_data_list) {
                //console.log(qor_data_list[0])
                var dir = encodeURIComponent($("#sqc-flow-dir").val());
                var pattern = $("#cpattern").text().trim();
                // var stage = $("#cstage").text().trim().toLowerCase().substring(2, 6);
                var stage = "{{stage|safe}}";
                var reg = /\d+/;
                var prevp = qor_data_list[0].match(reg);
                var crntp = qor_data_list[2].match(reg);
                var url = window.location.pathname.split('/')
                url =url.slice(0,url.length-1).join('/')
                var mt = "http://"+window.location.host+url+"/profile_"+ stage + "?mode=flow&pattern=all&compress=1&input_list=" + dir +"&cmd=" + stage +"&active_design=" + design_name
                    +"&active_metrics=undefined&active_pattern=" + pattern + "&prev_d=0&prev_p=" + prevp + "&crnt_d=0&crnt_p="+ crntp ;
                var data_ele = {
                    "design_name": design_name,
                    "step_name": qor_data_list[2],
                    "step_val": qor_data_list[3],
                    "base_name": qor_data_list[0],
                    "base_val": qor_data_list[1],
                    "pct": qor_data_list[4],
                    "link": "<a href='"+ mt +"'>View</a>"
                }
                window.bs_data.push(data_ele)
                //$("#sqb_bs_table").append(trHTML)
            })
            //console.log(design_name)
            //console.log(value)
        });

        var distri_list = getDistriCount(window.bs_data);
        console.log(distri_list);

        myBarChart2.config.data.datasets[0].data = distri_list;
        myBarChart2.update();
        $('#sqc_bs_table').bootstrapTable('destroy').bootstrapTable({
            //toolbar: '#toolbar',                //工具按钮用哪个容器
            striped: true,                      //是否显示行间隔色
            //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true,                   //是否显示分页（*）
            sortable: true,                     //是否启用排序
            //sortOrder: "asc",                   //排序方式
            //queryParams: oTableInit.queryParams,//传递参数（*）
            //sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageNumber:1,                       //初始化加载第一页，默认第一页
            pageSize: 50,                       //每页的记录行数（*）
            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
            search: true,
            showColumns: true,
            showExport: true,
            //strictSearch: true,
            //clickToSelect: true,                //是否启用点击选中行
            //height: 460,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            //uniqueId: "id",                     //每一行的唯一标识，一般为主键列
            //cardView: false,                    //是否显示详细视图
            //detailView: false,                   //是否显示父子表
            columns: [{
                field: 'design_name',
                title: 'Design Name',
                sortable: true
            },{
                field: 'base_name',
                title: 'Base Step',
                sortable: true
            }, {
                field: 'base_val',
                title: 'Base Value',
                sortable: true
            },  {
                field: 'step_name',
                title: 'Compare Name',
                sortable: true
            }, {
                field: 'step_val',
                title: 'Step Value',
                sortable: true
            }, {
                field: 'pct',
                title: 'Percentage (%)',
                sortable: true
            },{
                field: 'link',
                title: 'Profile link',
                sortable: true,
            }
            ],
            data: window.bs_data
        });
    }

    function switchSqcNewMetrics(e){
        $(".sqc-chart").css("display","none");
        var summary1 = [];
        for(key in  window.step_qor_info) {
            summary1.push([key]);
        }
//                console.log(summary);
        summary1_data = [];
        $.each(summary1,function(index,dvalue){
            window.bs_data = [];
            $.each(window.step_qor_info[dvalue], function(design_name, value) {
                if (value == "null") {
                    return true;
                }
                $.each(value, function(index, qor_data_list) {
                    var data_ele = {
                        "pct": qor_data_list[4]
                    };
                    window.bs_data.push(data_ele);
                })
            });
            var distri_list = getDistriCount(window.bs_data);
            //console.log(distri_list);
            summary1_data.push(distri_list);
        });

        $(".sqc-summary").empty();
        $.each(summary1,function(index,svalue){
            var newdiv = "<div class='col-md-3' style='padding:5px;'> <div class='panel' style='border-color: #54c7ce;'>"
                +" <div class='panel-heading'>"+svalue+"</div> <canvas id='Sqccanvas"+index+"' width='300' height='300'></canvas></div> </div>";
            $(".sqc-summary").append(newdiv);
            var ctx3 = $("#Sqccanvas"+index).get(0).getContext("2d");
            var data4 = {
                labels: ["-100%+", "-100%", "(-100%~-80%]", "(-80%+~-50%]","(-50%~-20%]", "(-20%~-10%]", "(-10%~-0%)", "0%", "(+0%~+10%)", "[+10%~+20%)", "[+20%~+50%)", "[+50%~+80%)", "[+80%~+100%)", "+100%", "+100%+"],
                datasets: [
                    {
                        label: "qor distribution",
                        backgroundColor: [
                            'rgba(153, 204, 51, 1)',
                            'rgba(153, 204, 51, 0.9)',
                            'rgba(153, 204, 51, 0.8)',
                            'rgba(153, 204, 51, 0.6)',
                            'rgba(153, 204, 51, 0.5)',
                            'rgba(153, 204, 51, 0.3)',
                            'rgba(153, 204, 51, 0.1)',
                            'rgba(119, 119, 119, 0.2)',
                            'rgba(255, 99, 132, 0.1)',
                            'rgba(255, 99, 132, 0.3)',
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(255, 99, 132, 0.9)',
                            'rgba(255, 99, 132, 1)',

                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(119, 119, 119, 0.8)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                        ],
                        borderWidth: 1,
                        data: [65, 59, 80, 81, 56, 55, 40, 22, 45, 68, 34, 67 ,67, 23, 88],
                    },
                ],
            };
            window[svalue] = new Chart(ctx3, {
                type: 'bar',
                data: data4,
                options: {
                    legend: {
                        display: false,
                        generateLabels: [{
                            hidden: true,
                        }]
                    },
                    showAllTooltips: true,
                    tooltips: {
                                callbacks: {
                                    label: function(tooltipItem, data) {
                                        if (window.display_designs.length > 0) {
                                            return window.display_designs;
                                        } else {
                                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                                            var tooltipLabel = data.labels[tooltipItem.index];
                                            var tooltipData = allData[tooltipItem.index];
                                            var total = 0;
                                            for (var i in allData) {
                                                total += allData[i];
                                            }
                                            var tooltipPercentage = Math.round((tooltipData / total) * 100);
                                            return tooltipData + ' (' + tooltipPercentage + '%)';
                                        }
                                    },
                                }                         
                            }, 
                    scales: {
                        xAxes: [{
                            display:true,
                            ticks: {
                                callback: function(dataLabel, index) {
                                return index == 7 ? dataLabel : '';
                                }    
                            }
                        }],
                        yAxes: [{
                            stacked: true
                        }]
                    }
                }
            });
            window[svalue].config.data.datasets[0].data = summary1_data[index];
            window[svalue].update();
        });

        $("#sqc-switch").text("SUMMARY");
        $(".sqc-summary").css("display","block");
    }

    function switchSqtMetrics(e) {
        var metrics = $(e).attr('id');
        console.log(metrics);
        $("#sqt-switch").text(metrics);
        $(".sqt-summary").css("display","none");
        $(".sqt-chart").css("display","block");
        window.bs_data = [];
        $.each(window.step_qor_info[metrics], function(design_name, value) {
            if (value == "null") {
                return true;
            }
            $.each(value, function(index, qor_data_list) {
                //console.log(qor_data_list[0])
                var dir = encodeURIComponent($("#sqt1-flow-dir").val());
                var pattern = $("#tpattern").text().trim();
                // var stage = $("#tstage").text().trim().toLowerCase().substring(2, 6);
                var stage = "{{stage|safe}}";
                var reg = /\d+/;
                var prevp = qor_data_list[0].match(reg);
                var crntp = qor_data_list[2].match(reg);
                var url = window.location.pathname.split('/')
                url =url.slice(0,url.length-1).join('/')
                var mt = "http://"+window.location.host+url+"/profile_"+ stage + "?mode=flow&pattern=all&compress=1&input_list=" + dir +"&cmd=" + stage +"&active_design=" + design_name
                    +"&active_metrics=undefined&active_pattern=" + pattern + "&prev_d=0&prev_p=" + prevp + "&crnt_d=0&crnt_p="+ crntp ;
                var data_ele = {
                    "design_name": design_name,
                    "step_name": qor_data_list[2],
                    "step_val": qor_data_list[3],
                    "base_name": qor_data_list[0],
                    "base_val": qor_data_list[1],
                    "pct": qor_data_list[4],
                    "link": "<a href='"+ mt +"'>View</a>"
                }
                window.bs_data.push(data_ele)
                //$("#sqb_bs_table").append(trHTML)
            })
            //console.log(design_name)
            //console.log(value)
        });

        var distri_list = getDistriCount(window.bs_data);
        console.log(distri_list);

        myBarChart3.config.data.datasets[0].data = distri_list;
        myBarChart3.update();
        $('#sqt_bs_table').bootstrapTable('destroy').bootstrapTable({
            //toolbar: '#toolbar',                //工具按钮用哪个容器
            striped: true,                      //是否显示行间隔色
            //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true,                   //是否显示分页（*）
            sortable: true,                     //是否启用排序
            //sortOrder: "asc",                   //排序方式
            //queryParams: oTableInit.queryParams,//传递参数（*）
            //sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageNumber:1,                       //初始化加载第一页，默认第一页
            pageSize: 50,                       //每页的记录行数（*）
            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
            search: true,
            showColumns: true,
            showExport: true,
            //strictSearch: true,
            //clickToSelect: true,                //是否启用点击选中行
            //height: 460,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            //uniqueId: "id",                     //每一行的唯一标识，一般为主键列
            //cardView: false,                    //是否显示详细视图
            //detailView: false,                   //是否显示父子表
            columns: [{
                field: 'design_name',
                title: 'Design Name',
                sortable: true
            },{
                field: 'base_name',
                title: 'Base Step',
                sortable: true
            }, {
                field: 'base_val',
                title: 'Base Value',
                sortable: true
            },  {
                field: 'step_name',
                title: 'Step Name',
                sortable: true
            }, {
                field: 'step_val',
                title: 'Step Value',
                sortable: true
            }, {
                field: 'pct',
                title: 'Percentage (%)',
                sortable: true
            },{
                field: 'link',
                title: 'Profile link',
                sortable: true,

            }
            ],
            data: window.bs_data
        });
    }

    function switchSqtNewMetrics(e){
        $(".sqt-chart").css("display","none");
        var summary = [];
        for(key in  window.step_qor_info) {
            summary.push([key]);
        }
        summary_data = [];
        $.each(summary,function(index,dvalue){
            window.bs_data = [];
            $.each(window.step_qor_info[dvalue], function(design_name, value) {
                if (value == "null") {
                    return true;
                }
                $.each(value, function(index, qor_data_list) {
                    var data_ele = {
                        "pct": qor_data_list[4]
                    };
                    window.bs_data.push(data_ele);
                })
            });
            var distri_list = getDistriCount(window.bs_data);
            //console.log(distri_list);
            summary_data.push(distri_list);
        });

        $(".sqt-summary").empty();
        $.each(summary,function(index,svalue){
            var newdiv = "<div class='col-md-3' style='padding:5px;'> <div class='panel' style='border-color: #54c7ce;'>"
                +" <div class='panel-heading'>"+svalue+"</div> <canvas id='canvas"+index+"' width='300' height='300'></canvas></div> </div>";
            $(".sqt-summary").append(newdiv);
            var ctx = $("#canvas"+index).get(0).getContext("2d");
            var data3 = {
                labels: ["-100%+", "-100%", "(-100%~-80%]", "(-80%+~-50%]","(-50%~-20%]", "(-20%~-10%]", "(-10%~-0%)", "0%", "(+0%~+10%)", "[+10%~+20%)", "[+20%~+50%)", "[+50%~+80%)", "[+80%~+100%)", "+100%", "+100%+"],
                datasets: [
                    {
                        label: "qor distribution",
                        backgroundColor: [
                            'rgba(153, 204, 51, 1)',
                            'rgba(153, 204, 51, 0.9)',
                            'rgba(153, 204, 51, 0.8)',
                            'rgba(153, 204, 51, 0.6)',
                            'rgba(153, 204, 51, 0.5)',
                            'rgba(153, 204, 51, 0.3)',
                            'rgba(153, 204, 51, 0.1)',
                            'rgba(119, 119, 119, 0.2)',
                            'rgba(255, 99, 132, 0.1)',
                            'rgba(255, 99, 132, 0.3)',
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(255, 99, 132, 0.9)',
                            'rgba(255, 99, 132, 1)',
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(119, 119, 119, 0.8)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                            'rgba(255,99,132,1)',
                        ],
                        borderWidth: 1,
                        data: [65, 59, 80, 81, 56, 55, 40, 22, 45, 68, 34, 67 ,67, 23, 88],
                    },
                ],
            };
            var mySummaryBarChart0 = new Chart(ctx, {
                type: 'bar',
                data: data3,
                options: {
                    legend: {
                        display: false,
                        generateLabels: [{
                            hidden: true
                        }]
                    },
                    tooltips: {
                        enabled: true
                    },
                    scaleShowLabels : false,
                    scales: {
                        xAxes: [{
                            display:true,
                            ticks: {
                                callback: function(dataLabel, index) {
                                    return index == 7 ? dataLabel : '';
                                }    
                            }
                        }],
                        yAxes: [{
                            stacked: true
                        }]
                    }
                }
            });

            mySummaryBarChart0.config.data.datasets[0].data = summary_data[index];
            mySummaryBarChart0.update();
        });

        $("#sqt-switch").text("SUMMARY");
        $(".sqt-summary").css("display","block");
    }

    function getDistriCount(obj) {
        var distri_list = [];
        var filter_list = filterDistriCount(obj);
        $.each(filter_list,function(index,value){
            distri_list.push(value.length);
        })
        return distri_list
    }

    function filterDistriCount(obj) {
        var distri_list = []
        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) < -100;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) == -100;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) > -100 && parseFloat(v.pct) <= -80;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) > -80 && parseFloat(v.pct) <= -50;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) > -50 && parseFloat(v.pct) <= -20;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) > -20 && parseFloat(v.pct) <= -10;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) > -10 && parseFloat(v.pct) < 0;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) == 0;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) > 0 && parseFloat(v.pct) < 10;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) >= 10 && parseFloat(v.pct) < 20;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) >= 20 && parseFloat(v.pct) < 50;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) >= 50 && parseFloat(v.pct) < 80;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) >= 80 && parseFloat(v.pct) < 100;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) == 100;
        });
        distri_list.push(filtered_obj)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) > 100;
        });
        distri_list.push(filtered_obj)

        return distri_list
    }

    function getNewDistriCount(obj) {
        var distri_list = []

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) < 0;
        });
        distri_list.push(filtered_obj.length)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) == 0;
        });
        distri_list.push(filtered_obj.length)

        var filtered_obj = $.grep(obj, function(v) {
            return parseFloat(v.pct) > 0
        });
        distri_list.push(filtered_obj.length)
        return distri_list
    }

    function activeSQBMethod(e) {

        var method = $(e).attr('id');
        var method_full = $(e).text();
        //console.log(mode);
        $("#method").text(method_full);
        $(".sqc-chart").css("display","none");
        $(".sqc-switch").css("display","none");
        $(".sqb-summary").css("display","none");
        $(".sqc-summary").css("display","none");
        $("#error-warning").css("display","none");
        $(".analysis_area").css("display", "none");
        // $("#sqb-hide").css("display","none");
        $(".sqt-chart").css("display","none");
        $(".sqt-switch").css("display","none");
        $(".sqt-summary").css("display","none");
        // $("#sqb1-step-name").css("display","none");
        // $("#pattern").css("display","none");
        $("."+method).css("display", "table");
        //console.log($("#compress-mode").val());
    }

    function activeSQCMethod(e) {
        var method = $(e).attr('id');
        var method_full = $(e).text();
        //console.log(mode);
        $("#method").text(method_full);
        $(".sqb-chart").css("display","none");
        $(".sqc-switch").css("display","none");
        $(".sqc-chart").css("display","none");
        $(".sqb-switch").css("display","none");
        $(".sqb-summary").css("display","none");
        $(".sqc-summary").css("display","none");
        $("#sqc-hide").css("display","none");
        $(".sqt-chart").css("display","none");
        $(".sqt-switch").css("display","none");
        $(".sqt-summary").css("display","none");
        $("#error-warning").css("display","none");
        $(".analysis_area").css("display", "none");
        $("."+method).css("display", "table");
        //console.log($("#compress-mode").val());
    }

    function activeSQAMethod(e){
        var method = $(e).attr('id');
        var method_full = $(e).text();
        //console.log(mode);
        $("#method").text(method_full);
        $(".sqb-chart").css("display","none");
        $(".sqc-switch").css("display","none");
        $(".sqc-chart").css("display","none");
        $(".sqb-switch").css("display","none");
        $(".sqb-summary").css("display","none");
        $(".sqc-summary").css("display","none");
        $("#sqt-hide").css("display","none");
        $(".sqt-chart").css("display","none");
        $(".sqt-switch").css("display","none");
        $(".sqt-summary").css("display","none");
        $("#error-warning").css("display","none");
        $(".analysis_area").css("display", "none");
        $("."+method).css("display", "table");
        //console.log($("#compress-mode").val());
    }

    function activeMode(e) {
        var mode = $(e).text();
        //console.log(mode);
        $("#mode").html(mode+" <span class=\"caret\"></span>");
        //console.log($("#compress-mode").val());
    }

    function activeStage(e) {
        var stage = $(e).text();
        //console.log(mode)
        $("#stage").html(stage);
        //console.log($("#compress-mode").val());
    }

    function activePattern(e) {
        var pattern = $(e).text();
        //console.log(mode);
        $("#pattern").html(pattern);
        var stepname = window.steps_list_dict[$("#pattern").text().trim()][0];
        $("#sqbstep-name-switch").html(stepname);
        $("#sqb1-step-name").val(stepname);
        $("#sqbstep-name-switch-li").empty();
        $.each(window.steps_list_dict, function(name_list, step) {
            if(name_list == $("#pattern").text().trim()){
                $.each(step,function(dict){
                    var li = "<li><a href='#' id='"+step[dict]+"'onclick='switchStepName(this);'>"+step[dict]+"</a></li>"
                    $("#sqbstep-name-switch-li").append(li);
                })
            }
        })
        //console.log($("#compress-mode").val());
    }

    function activeSqcStage(e) {
        var stage = $(e).text();
        //console.log(mode);
        $("#cstage").html(stage);
        //console.log($("#compress-mode").val());
    }

    function activeSqcPattern(e) {
        var pattern = $(e).text();
        $("#cpattern").html(pattern);
        var stepname = window.steps_list_dict[$("#cpattern").text().trim()][0];
        $("#sqcstep-name-switch").html(stepname);
        $("#sqc-base-name").val(stepname);
        $("#sqcstep-name-switch-li").empty();
        $("#sqccmp-name-switch-li").empty();
        $.each(window.steps_list_dict, function(name_list, step) {
            if(name_list == $("#cpattern").text().trim()){
                $.each(step,function(index1,dict){
                    var li = "<li><a href='#' id='"+dict+"'onclick='switchBaseName(this,"+index1+");'>"+dict+"</a></li>"
                    $("#sqcstep-name-switch-li").append(li);
                })
                $.each(step,function(index2,dict){
                    if(index2>0){
                        var li = "<li><a href='#' id='"+dict+"'onclick='switchCmpName(this,"+index2+");'>"+dict+"</a></li>"
                        $("#sqccmp-name-switch-li").append(li);
                    }
                })
            }
        })
    }

    function activeSqtStage(e) {
        var stage = $(e).text();
        //console.log(mode)
        $("#tstage").html(stage);
        //console.log($("#compress-mode").val());
    }

    function activeSqtPattern(e) {
        var pattern = $(e).text();
        //console.log(mode);
        $("#tpattern").html(pattern);
    }

    function isEmptyObject(e) {
        var t;
        for (t in e)
            return !1;
        return !0;
    }

    function sqbClick1(data){
        var warn = $("#error-warning");
            warn.text("");
                    if(data["result"]=="success"){
                        judgeEmpty = jQuery.parseJSON(data["steps_list_dict"]);
                        if(isEmptyObject(judgeEmpty)){
                            warn.css("display","block");
                            warn.attr("class","alert alert-warning");
                            warn.append("<strong>Data</strong> do not exist");
                            // l.stop();
                            return false;
                        }
                    }
                    else{
                        warn.css("display","block");
                        warn.attr("class","alert alert-danger");
                        warn.append(data["msg"]);
                        // l.stop();
                        return false;
                    }
                    window.steps_list_dict = jQuery.parseJSON(data["steps_list_dict"]);
                    console.log(steps_list_dict);
                    $("#sqb-hide").css("display","block");
                    $("#pattern-switch-li").empty();
                    $.each(window.steps_list_dict, function(name_list, pattern) {
                        var li = "<li><a href='#' id='"+name_list+"'onclick='activePattern(this);'>"+name_list+"</a></li>"
                        $("#pattern-switch-li").append(li);
                    })
                    if(first_pattern!=""){
                        $("#pattern").text(first_pattern);
                        $("#sqbstep-name-switch-li").empty();
                        $.each(window.steps_list_dict, function(name_list, step) {
                        if(name_list == $("#pattern").text().trim()){
                            $.each(step,function(dict){
                                var li = "<li><a href='#' id='"+step[dict]+"'onclick='switchStepName(this);'>"+step[dict]+"</a></li>"
                            $("#sqbstep-name-switch-li").append(li);
                            })
                        }
                    })
                    }
    }

    function sqbClick2(data){
        var warn = $("#error-warning");
            warn.text("");
         window.bs_data = [];
                    if(data["result"]=="success"){
                        judgeEmpty = jQuery.parseJSON(data["step_qor_info"]);
                        if(isEmptyObject(judgeEmpty)){
                            warn.css("display","block");
                            warn.attr("class","alert alert-warning");
                            warn.append("<strong>Data</strong> do not exist");
                            // l.stop();
                            return false;
                        }
                    }
                    else{
                        warn.css("display","block");
                        warn.attr("class","alert alert-danger");
                        warn.append(data["msg"]);
                        // l.stop();
                        return false;
                    }
                    window.step_qor_info = jQuery.parseJSON(data["step_qor_info"]);
                    metrics = data['default_metrics'];
                    console.log(window.step_qor_info);
                    $('#sqb-design-select').empty();
                    window.all_select = [];
                    $.each(window.step_qor_info[metrics], function(design_name, value) {
                        if (value == "null") {
                            return true;
                        }
                        window.all_select.push(design_name);
                        $('#sqb-design-select').append('<option value="' + design_name + '"> ' + design_name + '</option>');
                        $.each(value, function(index, qor_data_list) {
                            //console.log(qor_data_list[0])
                            var dir = encodeURIComponent($("#sqb1-flow-dir").val());
                            var pattern = $("#pattern").text().trim();
                            // var stage = $("#stage").text().trim().toLowerCase().substring(2, 6);
                            var stage = "{{stage|safe}}";
                            var reg = /\d+/;
                            var prevp = qor_data_list[0].match(reg);
                            var crntp = qor_data_list[2].match(reg);
                            var url = window.location.pathname.split('/')
                            url =url.slice(0,url.length-1).join('/')
                            var mt = "http://"+window.location.host+url+"/profile_"+ stage + "?mode=flow&pattern=all&compress=1&input_list=" + dir +"&cmd=" + stage +"&active_design=" + design_name+"&active_metrics=undefined&active_pattern=" + pattern + "&prev_d=0&prev_p=" + prevp + "&crnt_d=0&crnt_p="+ crntp ;
                            var data_ele = {
                                "design_name": design_name,
                                "step_name": qor_data_list[2],
                                "step_val": qor_data_list[3],
                                "base_name": qor_data_list[0],
                                "base_val": qor_data_list[1],
                                "pct": qor_data_list[4],
                                "link": "<a href='"+ mt +"'>View</a>"
                            }
                            window.bs_data.push(data_ele)
                            //$("#sqb_bs_table").append(trHTML)
                        })
                        // console.log(design_name)
                        //console.log(value)
                    })
                    window.selected_metrics = metrics;
                    $('#sqb-design-select').multiselect("destroy").multiselect({
                        includeSelectAllOption: true,
                        buttonWidth: '200px',
                        onSelectAll: function() {
                            $.each(window.all_select,function(index,value){
                                window.selected_designs.push(value);
                            });

                            if($("#sqb-switch").text()=="SUMMARY"){
                                $.each(window.step_qor_info,function(index){
                                    window.selected_metrics = index;
                                    window[index].update();
                                });
                            }
                            else{
                                myBarChart.update();
                            }
                        
                        },
                        onDeselectAll:function(){
                            window.selected_designs = [];
                            if($("#sqb-switch").text()=="SUMMARY"){
                                $.each(window.step_qor_info,function(index){
                                    window.selected_metrics = index;
                                    window[index].update();
                                });
                            }
                            else{
                                 myBarChart.update();
                            }
                        },
                        onChange: function(option, checked, select) {
                            design_name = $(option).val();
                            if (checked == true) {
                                window.selected_designs.push(design_name);

                                if($("#sqb-switch").text()=="SUMMARY"){
                                    $.each(window.step_qor_info,function(index){
                                        window.selected_metrics = index;
                                        window[index].update();
                                    });
                                }
                                else{
                                    myBarChart.update();
                                }
                            }

                            if (checked == false) {
                                pos = jQuery.inArray(design_name, window.selected_designs);
                                window.selected_designs.splice(pos,1)
                                if($("#sqb-switch").text()=="SUMMARY"){
                                    $.each(window.step_qor_info,function(index){
                                        window.selected_metrics = index;
                                        window[index].update();
                                    });
                                }
                                else{
                                    myBarChart.update();
                                }
                            }                           
                            //console.log($(option).val() + $(option).selected());
                        }
                    });
                    $("#sqb-switch").text(metrics);
                    $("#sqb-switch-li").empty();
                    $.each(window.step_qor_info, function(metrics, dict) {
                        var li = "<li><a href='#' id='"+metrics+"' onclick='switchMetrics(this);'>"+metrics+"</a></li>"
                        $("#sqb-switch-li").append(li);
                    })
                    var li = "<li><a href='#' id='summary' onclick='switchNewMetrics(this);'>"+"SUMMARY"+"</a></li>"
                    $("#sqb-switch-li").append(li);
                    var distri_list = getDistriCount(window.bs_data);

                    myBarChart.config.data.datasets[0].data = distri_list;
                    myBarChart.update();

                    $('#sqb_bs_table').bootstrapTable('destroy').bootstrapTable({
                        //toolbar: '#toolbar',                //工具按钮用哪个容器
                        striped: true,                      //是否显示行间隔色
                        //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                        pagination: true,                   //是否显示分页（*）
                        sortable: true,                     //是否启用排序
                        //sortOrder: "asc",                   //排序方式
                        //queryParams: oTableInit.queryParams,//传递参数（*）
                        //sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                        pageNumber:1,                       //初始化加载第一页，默认第一页
                        pageSize: 50,                       //每页的记录行数（*）
                        pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                        search: true,
                        showExport: true,                    //是否显示导出
                        exportDataType: "all",
                        showColumns: true,

                        columns: [{
                            field: 'design_name',
                            title: 'Design Name',
                            sortable: true
                        },{
                            field: 'base_name',
                            title: 'Base Step',
                            sortable: true
                        }, {
                            field: 'base_val',
                            title: 'Base Value',
                            sortable: true
                        },  {
                            field: 'step_name',
                            title: 'Step Name',
                            sortable: true
                        }, {
                            field: 'step_val',
                            title: 'Step Value',
                            sortable: true
                        }, {
                            field: 'pct',
                            title: 'Percentage (%)',
                            sortable: true
                        },{
                            field: 'link',
                            title: 'Profile link',
                            sortable: true,
                        }
                        ],
                        data: window.bs_data
                    });

                    $("#sqb-hide").css("display","block");
                    $(".sqb-chart").css("display","block");
                    $(".sqb-switch").css("display", "table");
    }

    function sqcClick1(data){
        var warn = $("#error-warning");
            warn.text("");
            if(data["result"]=="success"){
                        judgeEmpty = jQuery.parseJSON(data["steps_list_dict"]);
                        if(isEmptyObject(judgeEmpty)){
                            warn.css("display","block");
                            warn.attr("class","alert alert-warning");
                            warn.append("<strong>Data</strong> do not exist");
                            // l.stop();
                            return false;
                        }
                    }
                    else{
                        warn.css("display","block");
                        warn.attr("class","alert alert-danger");
                        warn.append(data["msg"]);
                        // l.stop();
                        return false;
                    }
                    window.steps_list_dict = jQuery.parseJSON(data["steps_list_dict"]);
                    //console.log(steps_list_dict);
                    $("#sqc-hide").css("display","block");
                    $("#cpattern-switch-li").empty();
                    $.each(window.steps_list_dict, function(name_list, pattern) {
                        var li = "<li><a href='#' id='"+name_list+"'onclick='activeSqcPattern(this);'>"+name_list+"</a></li>"
                        $("#cpattern-switch-li").append(li);
                    })

                    if(first_pattern!=""){
                        $("#sqcstep-name-switch-li").empty();
                        $("#sqccmp-name-switch-li").empty();
                        $.each(window.steps_list_dict, function(name_list, step) {
                            if(name_list == $("#cpattern").text().trim()){
                                $.each(step,function(index1,dict){
                                var li = "<li><a href='#' id='"+dict+"'onclick='switchBaseName(this,"+index1+");'>"+dict+"</a></li>"
                                $("#sqcstep-name-switch-li").append(li);
                            })
                        $.each(step,function(index2,dict){
                            if(index2>0){
                                var li = "<li><a href='#' id='"+dict+"'onclick='switchCmpName(this,"+index2+");'>"+dict+"</a></li>"
                            $("#sqccmp-name-switch-li").append(li);
                            }
                        })
                    }
        })
                    }
    }

    function sqcClick2(data){
        var warn = $("#error-warning");
            warn.text("");
         window.bs_data = [];
                    if(data["result"]=="success"){
                        judgeEmpty = jQuery.parseJSON(data["step_qor_info"]);
                        if(isEmptyObject(judgeEmpty)){
                            warn.css("display","block");
                            warn.attr("class","alert alert-warning");
                            warn.append("<strong>Data</strong> do not exist");
                            // l.stop();
                            return false;
                        }
                    }
                    else{
                        warn.css("display","block");
                        warn.attr("class","alert alert-danger");
                        warn.append(data["msg"]);
                        // l.stop();
                        return false;
                    }
                    window.step_qor_info = jQuery.parseJSON(data["step_qor_info"]);
                    metrics = data['default_metrics'];
                    console.log(window.step_qor_info);
                    $('#sqc-design-select').empty();
                    window.all_select = [];
                    $.each(window.step_qor_info[metrics], function(design_name, value) {
                        if (value == "null") {
                            return true;
                        }
                        window.all_select.push(design_name);
                        $('#sqc-design-select').append('<option value="' + design_name + '"> ' + design_name + '</option>');
                        $.each(value, function(index, qor_data_list) {
                            //console.log(qor_data_list[0])
                            var dir = encodeURIComponent($("#sqc-flow-dir").val());
                            var pattern = $("#cpattern").text().trim();
                            // var stage = $("#cstage").text().trim().toLowerCase().substring(2, 6);
                            var stage = "{{stage|safe}}";
                            var reg = /\d+/;
                            var prevp = qor_data_list[0].match(reg);
                            var crntp = qor_data_list[2].match(reg);
                            var url = window.location.pathname.split('/')
                            url =url.slice(0,url.length-1).join('/')
                            var mt = "http://"+window.location.host+url+"/profile_"+ stage + "?mode=flow&pattern=all&compress=1&input_list=" + dir +"&cmd=" + stage +"&active_design=" + design_name
                                +"&active_metrics=undefined&active_pattern=" + pattern + "&prev_d=0&prev_p=" + prevp + "&crnt_d=0&crnt_p="+ crntp ;
                            var data_ele = {
                                "design_name": design_name,
                                "step_name": qor_data_list[2],
                                "step_val": qor_data_list[3],
                                "base_name": qor_data_list[0],
                                "base_val": qor_data_list[1],
                                "pct": qor_data_list[4],
                                "link": "<a href='"+ mt +"'>View</a>"
                            }
                            window.bs_data.push(data_ele)
                            //$("#sqb_bs_table").append(trHTML)
                        })
                        //console.log(design_name)
                        //console.log(value)
                    })
                    window.selected_metrics = metrics;

                    $('#sqc-design-select').multiselect("destroy").multiselect({
                        includeSelectAllOption: true,
                        buttonWidth: '200px',
                        onSelectAll: function() {
                            $.each(window.all_select,function(index,value){
                                window.selected_designs.push(value);
                            });

                            if($("#sqc-switch").text()=="SUMMARY"){
                                $.each(window.step_qor_info,function(index){
                                    window.selected_metrics = index;
                                    window[index].update();
                                });
                            }
                            else{
                                myBarChart2.update();
                            }
                        },
                        onDeselectAll:function(){
                            window.selected_designs = [];
                            if($("#sqc-switch").text()=="SUMMARY"){
                                $.each(window.step_qor_info,function(index){
                                    window.selected_metrics = index;
                                    window[index].update();
                                });
                            }
                            else{
                                 myBarChart2.update();
                            }
                        },
                        onChange: function(option, checked, select) {
                            design_name = $(option).val();
                            if (checked == true) {
                                window.selected_designs.push(design_name)
                                if($("#sqc-switch").text()=="SUMMARY"){
                                    $.each(window.step_qor_info,function(index){
                                        window.selected_metrics = index;
                                        window[index].update();
                                    });
                                }
                                else{
                                    myBarChart2.update();
                                }
                            }

                            if (checked == false) {
                                pos = jQuery.inArray(design_name, window.selected_designs);
                                window.selected_designs.splice(pos,1)
                                if($("#sqc-switch").text()=="SUMMARY"){
                                    $.each(window.step_qor_info,function(index){
                                        window.selected_metrics = index;
                                        window[index].update();
                                    });
                                }
                                else{
                                    myBarChart2.update();
                                }
                            }                           
                            //console.log($(option).val() + $(option).selected());
                        }
                    });
                    $("#sqc-switch").text(metrics);
                    $("#sqc-switch-li").empty();
                    $.each(window.step_qor_info, function(metrics, dict) {
                        var li = "<li><a href='#' id='"+metrics+"' onclick='switchSqcMetrics(this);'>"+metrics+"</a></li>"
                        $("#sqc-switch-li").append(li);
                    })
                    var li = "<li><a href='#' id='summary1' onclick='switchSqcNewMetrics(this);'>"+"SUMMARY"+"</a></li>"
                    $("#sqc-switch-li").append(li);
                    var distri_list = getDistriCount(window.bs_data);
//                      console.log(distri_list)

                    myBarChart2.config.data.datasets[0].data = distri_list;
                    myBarChart2.update();

                    $('#sqc_bs_table').bootstrapTable('destroy').bootstrapTable({
                        //toolbar: '#toolbar',                //工具按钮用哪个容器
                        striped: true,                      //是否显示行间隔色
                        //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                        pagination: true,                   //是否显示分页（*）
                        sortable: true,                     //是否启用排序
                        //sortOrder: "asc",                   //排序方式
                        //queryParams: oTableInit.queryParams,//传递参数（*）
                        //sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                        pageNumber:1,                       //初始化加载第一页，默认第一页
                        pageSize: 50,                       //每页的记录行数（*）
                        pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                        search: true,
                        showExport: true,                    //是否显示导出
                        exportDataType: "all",
                        showColumns: true,
//                            showPaginationSwitch:true,
                        //strictSearch: true,
                        //clickToSelect: true,                //是否启用点击选中行
                        //height: 460,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                        //uniqueId: "id",                     //每一行的唯一标识，一般为主键列
                        //cardView: false,                    //是否显示详细视图
                        //detailView: false,                   //是否显示父子表
                        columns: [{
                            field: 'design_name',
                            title: 'Design Name',
                            sortable: true
                        },{
                            field: 'base_name',
                            title: 'Base Step',
                            sortable: true
                        }, {
                            field: 'base_val',
                            title: 'Base Value',
                            sortable: true
                        },  {
                            field: 'step_name',
                            title: 'Compare Name',
                            sortable: true
                        }, {
                            field: 'step_val',
                            title: 'Step Value',
                            sortable: true
                        }, {
                            field: 'pct',
                            title: 'Percentage (%)',
                            sortable: true
                        },{
                            field: 'link',
                            title: 'Profile link',
                            sortable: true,
                        }
                        ],
                        data: window.bs_data
                    });

                    //$('#sqb_bs_table')

                    $(".sqc-chart").css("display","block");
                    $(".sqc-switch").css("display", "table");
    }

    function sqtClick1(data){
        var warn = $("#error-warning");
            warn.text("");
         // window.steps_list_dict = ["NWPOPT","NWCOPT","NWFOPT"];
                    if(data["result"]=="success"){
                        judgeEmpty = jQuery.parseJSON(data["steps_list_dict"]);
                        if(isEmptyObject(judgeEmpty)){
                            warn.css("display","block");
                            warn.attr("class","alert alert-warning");
                            warn.append("<strong>Data</strong> do not exist");
                            // l.stop();
                            return false;
                        }
                    }
                    else{
                        warn.css("display","block");
                        warn.attr("class","alert alert-danger");
                        warn.append(data["msg"]);
                        // l.stop();
                        return false;
                    }
                    window.steps_list_dict = jQuery.parseJSON(data["steps_list_dict"]);
                    //console.log(steps_list_dict);
                    $("#sqt-hide").css("display","block");
                    $("#tpattern-switch-li").empty();
                    $.each(window.steps_list_dict, function(name_list, pattern) {
                        var li = "<li><a href='#' id='"+name_list+"'onclick='activeSqtPattern(this);'>"+name_list+"</a></li>"
                        $("#tpattern-switch-li").append(li);
                    })
    }

    function sqtClick2(data){
        var warn = $("#error-warning");
            warn.text("");
         window.bs_data = [];
                    if(data["result"]=="success"){
                        judgeEmpty = jQuery.parseJSON(data["step_qor_info"]);
                        if(isEmptyObject(judgeEmpty)){
                            warn.css("display","block");
                            warn.attr("class","alert alert-warning");
                            warn.append("<strong>Data</strong> do not exist");
                            // l.stop();
                            return false;
                        }
                    }
                    else{
                        warn.css("display","block");
                        warn.attr("class","alert alert-danger");
                        warn.append(data["msg"]);
                        // l.stop();
                        return false;
                    }

                    window.step_qor_info = jQuery.parseJSON(data["step_qor_info"]);
                    metrics = data['default_metrics'];
                    // info_index = []
                    // $.each(window.step_qor_info, function(value){
                    //     info_index.push(value)
                    // })
                    // metrics = info_index[0]
                    $('#sqt-design-select').empty();
                    window.all_select = [];
                    console.log(window.step_qor_info);
                    $.each(window.step_qor_info[metrics], function(design_name, value) {
                        if (value == "null") {
                            return true;
                        }
                        window.all_select.push(design_name);
                        $('#sqt-design-select').append('<option value="' + design_name + '"> ' + design_name + '</option>');
                        $.each(value, function(index, qor_data_list) {
                            //console.log(qor_data_list[0])
                            var dir = encodeURIComponent($("#sqt1-flow-dir").val());
                            var pattern = $("#tpattern").text().trim();
                            // var stage = $("#tstage").text().trim().toLowerCase().substring(2, 6);
                            var stage = "{{stage|safe}}";
                            var reg = /\d+/;
                            var prevp = qor_data_list[0].match(reg);
                            var crntp = qor_data_list[2].match(reg);
                            var url = window.location.pathname.split('/')
                            url =url.slice(0,url.length-1).join('/')
                            var mt = "http://"+window.location.host+url+"/profile_"+ stage + "?mode=flow&pattern=all&compress=1&input_list=" + dir +"&cmd=" + stage +"&active_design=" + design_name+"&active_metrics=undefined&active_pattern=" + pattern + "&prev_d=0&prev_p=" + prevp + "&crnt_d=0&crnt_p="+ crntp ;
                            var data_ele = {
                                "design_name": design_name,                               
                                "base_name": qor_data_list[0],
                                "base_val": qor_data_list[1],
                                "step_name": qor_data_list[2],
                                "step_val": qor_data_list[3],
                                "pct": qor_data_list[4],
                                "link": "<a href='"+ mt +"'>View</a>"
                            }
                            window.bs_data.push(data_ele)
                            //$("#sqb_bs_table").append(trHTML)
                        })
                        //console.log(design_name)
                        //console.log(value)
                    })
                    window.selected_metrics = metrics;
                    $('#sqt-design-select').multiselect("destroy").multiselect({
                        includeSelectAllOption: true,
                        buttonWidth: '200px',
                        onSelectAll: function() {
                            $.each(window.all_select,function(index,value){
                                window.selected_designs.push(value);
                            });

                            if($("#sqt-switch").text()=="SUMMARY"){
                                $.each(window.step_qor_info,function(index){
                                    window.selected_metrics = index;
                                    window[index].update();
                                });
                            }
                            else{
                                myBarChart3.update();
                            }
                        
                        },
                        onDeselectAll:function(){
                            window.selected_designs = [];
                            if($("#sqt-switch").text()=="SUMMARY"){
                                $.each(window.step_qor_info,function(index){
                                    window.selected_metrics = index;
                                    window[index].update();
                                });
                            }
                            else{
                                 myBarChart3.update();
                            }
                        },
                        onChange: function(option, checked, select) {
                            design_name = $(option).val();
                            if (checked == true) {
                                window.selected_designs.push(design_name)
                                if($("#sqt-switch").text()=="SUMMARY"){
                                    $.each(window.step_qor_info,function(index){
                                        window.selected_metrics = index;
                                        window[index].update();
                                    });
                                }
                                else{
                                    myBarChart3.update();
                                }
                            }

                            if (checked == false) {
                                pos = jQuery.inArray(design_name, window.selected_designs);
                                window.selected_designs.splice(pos,1)
                                if($("#sqt-switch").text()=="SUMMARY"){
                                    $.each(window.step_qor_info,function(index){
                                        window.selected_metrics = index;
                                        window[index].update();
                                    });
                                }
                                else{
                                    myBarChart3.update();
                                }
                            }                           
                            //console.log($(option).val() + $(option).selected());
                        }
                    });
                    $("#sqt-switch").text(metrics);
                    $("#sqt-switch-li").empty();
                    $.each(window.step_qor_info, function(metrics, dict) {
                        var li = "<li><a href='#' id='"+metrics+"' onclick='switchSqtMetrics(this);'>"+metrics+"</a></li>"
                        $("#sqt-switch-li").append(li);
                    })
                    var li = "<li><a href='#' id='summary' onclick='switchSqtNewMetrics(this);'>"+"SUMMARY"+"</a></li>"
                    $("#sqt-switch-li").append(li);
                    var distri_list = getDistriCount(window.bs_data);
//                      console.log(distri_list)

                    myBarChart3.config.data.datasets[0].data = distri_list;
                    myBarChart3.update();

                    $('#sqt_bs_table').bootstrapTable('destroy').bootstrapTable({
                        //toolbar: '#toolbar',                //工具按钮用哪个容器
                        striped: true,                      //是否显示行间隔色
                        //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                        pagination: true,                   //是否显示分页（*）
                        sortable: true,                     //是否启用排序
                        //sortOrder: "asc",                   //排序方式
                        //queryParams: oTableInit.queryParams,//传递参数（*）
                        //sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                        pageNumber:1,                       //初始化加载第一页，默认第一页
                        pageSize: 50,                       //每页的记录行数（*）
                        pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                        search: true,
                        showExport: true,                    //是否显示导出
                        exportDataType: "all",
                        showColumns: true,
//                            showPaginationSwitch:true,
                        //strictSearch: true,
                        //clickToSelect: true,                //是否启用点击选中行
                        //height: 460,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                        //uniqueId: "id",                     //每一行的唯一标识，一般为主键列
                        //cardView: false,                    //是否显示详细视图
                        //detailView: false,                   //是否显示父子表
                        columns: [{
                            field: 'design_name',
                            title: 'Design Name',
                            sortable: true
                        },{
                            field: 'base_name',
                            title: 'Base Step',
                            sortable: true
                        }, {
                            field: 'base_val',
                            title: 'Base Value',
                            sortable: true
                        },  {
                            field: 'step_name',
                            title: 'Step Name',
                            sortable: true
                        }, {
                            field: 'step_val',
                            title: 'Step Value',
                            sortable: true
                        }, {
                            field: 'pct',
                            title: 'Percentage (%)',
                            sortable: true
                        },{
                            field: 'link',
                            title: 'Profile link',
                            sortable: true,
                        }
                        ],
                        data: window.bs_data
                    });

                    //$('#sqb_bs_table')
                    // $("#sqb1-step-name").css("display","block");
                    // $("#stage").css("display","block");
                    $("#sqt-hide").css("display","block");
                    $(".sqt-chart").css("display","block");
                    $(".sqt-switch").css("display", "table");
    }

    $(function() {
        window.display_designs = new Array();
        window.selected_designs = new Array();
        window.selected_metrics = [];
        //jump to step benefit analysis

        first_pattern = "{{pattern|safe}}";
        stage = "{{stage|safe}}";
        first_name = "{{step_name|safe}}";
        first_stage = stage.toUpperCase();
        first_dir = "{{flow_dir|safe}}";
        second_dir = "{{second_dir|safe}}";
        mode = "{{mode|safe}}";
        single_name = "{{single_name|safe}}";
        second_name = "{{comp_name|safe}}";
        window.tech_nodes = {{tech_nodes|safe}};
        window.customers = {{customers|safe}};

        console.log(tech_nodes, customers);

        if(second_dir==""){
            second_dir = first_dir;
        }
        number = "{{number|safe}}";


        $('#sqb_btn').click(function(e){
            
            // $("#sqb-hide").css("display","none");
            $(".sqb-chart").css("display","none");
            $(".sqb-switch").css("display","none");
            $(".sqc-chart").css("display","none");
            $(".sqc-switch").css("display","none");
            $(".sqc-summary").css("display","none");
            $(".sqb-summary").css("display","none");

            $("#error-warning").css("display","none");
            var warn = $("#error-warning");
            warn.text("");
            $("#pattern").html("Pattern");
            $("#sqbstep-name-switch").text("Step name");
            if( $("#sqb1-flow-dir").val()==""){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>flow_dir</strong> should not be empty!");
                return false;
            }
            if($("#stage").text().trim()=="Stage"){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Stage</sstrong> Warn! Please choose the right stage! ");
                return false;
            }
            var l = Ladda.create(this);
            l.start();
            key_stage = $("#stage").text().trim();
            keydir1 = $("#sqb1-flow-dir").val();
            keydir2 = $("#sqb1-second-dir").val();
            var keyinfo = key_stage+"sqb1info";
            if(sessionStorage.getItem(keyinfo)&&(sessionStorage.getItem('dirlist1')==keydir1)&&(sessionStorage.getItem('dirlist2')==keydir2)){
                    strdata = sessionStorage.getItem(keyinfo);
                    inputdata = JSON.parse(strdata);
                    // lists = sessionStorage.getItem('dirlists');
                    sqbClick1(inputdata);
                    l.stop();
                    // inputdata.selected_pattern = active_pattern;
            }
            else{
            $.post('analysis_sqb', {
                step_name: "",
                flow_dir: $("#sqb1-flow-dir").val(),
                second_dir: $("#sqb1-second-dir").val(),
                pattern: first_pattern,
                stage: $("#stage").text().trim(),
                tech_nodes: JSON.stringify(window.tech_nodes),
                customers: JSON.stringify(window.customers),
            }, function () {
                console.log("sending post...")
            })
                .done(function(data) {
                    // window.steps_list_dict = ["NWPOPT","NWCOPT","NWFOPT"];
                    var keydata = JSON.stringify(data); 
                    key_stage = $("#stage").text().trim();
                    var keyvalue = key_stage+"sqb1info";
                    keydir1 = $("#sqb1-flow-dir").val();
                    keydir2 = $("#sqb1-second-dir").val();
                    sessionStorage.setItem(keyvalue,keydata);
                    sessionStorage.setItem("dirlist1",keydir1);
                    sessionStorage.setItem("dirlist2",keydir2);
                    sqbClick1(data);
                    console.log("first start success!");
                    l.stop();
                })
                .fail(function() {
                    //$(destId).text("Error: Could not contact server.");
                    l.stop();
                    console.log("fail!")
                });
            }
        })

        $('#sqb_btn1').click(function(e) {
            //console.log($("#sqb1-step-name").val())

            $(".sqb-chart").css("display","none");
            $(".sqb-switch").css("display","none");
            $(".sqc-chart").css("display","none");
            $(".sqc-switch").css("display","none");
            $("#error-warning").css("display","none");
            $(".sqb-summary").css("display","none");
            var warn = $("#error-warning");
            warn.text("");
            if($("#pattern").text().trim()=="Pattern"){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Pattern</strong> Warn! Please choose the right pattern! ");
                return false;
            }
            if($("#sqb1-step-name").val()==""){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Step name</strong> should not be empty!");
                return false;
            }
            var l = Ladda.create(this);
            l.start();
            key_stage = $("#stage").text().trim();
            key_pattern = $("#pattern").text().trim();
            key_name = $("#sqb1-step-name").val();
            keydir1 = $("#sqb1-flow-dir").val();
            keydir2 = $("#sqb1-second-dir").val();
            var keyinfo = key_stage+key_pattern+key_name+"sqb2info";
            if(sessionStorage.getItem(keyinfo)&&(sessionStorage.getItem('dirlist1')==keydir1)&&(sessionStorage.getItem('dirlist2')==keydir2)){
                    strdata = sessionStorage.getItem(keyinfo);
                    inputdata = JSON.parse(strdata);
                    // lists = sessionStorage.getItem('dirlists');
                    sqbClick2(inputdata);
                    l.stop();
                    // inputdata.selected_pattern = active_pattern;
            }
            else{
            if($("#sqb1-second-dir").val()==""){
                $("#sqb1-second-dir").val($("#sqb1-flow-dir").val());
            }
            $.post('analysis_sqb', {
                step_name: $("#sqb1-step-name").val(),
                flow_dir: $("#sqb1-flow-dir").val(),
                second_dir: $("#sqb1-second-dir").val(),
                pattern: $("#pattern").text().trim(),
                stage: $("#stage").text().trim(),
                tech_nodes: JSON.stringify(window.tech_nodes),
                customers: JSON.stringify(window.customers),
            }, function () {
                console.log("sending post...")
            })
                .done(function(data) {
                    //var thHTML='<thead><tr><th data-sortable="true" data-field="design_name"> design_name </th>
                    // <th data-sortable="true" data-field="step_name"> step_name </th><th data-sortable="true" data-field="step_val">
                    // step_val</th><th data-sortable="true" data-field="base_step"> base_step </th><th data-sortable="true" data-field="base_val">
                    // base_val</th><th data-sortable="true" data-field="Gain-Loss"> Gain/Loss Pct.</th></tr></thead>'
                    //$("#sqb_bs_table").append(thHTML)\
                    // window.steps_list_dict = ["NWPOPT","NWCOPT","NWFOPT"];
                    var keydata = JSON.stringify(data); 
                    key_stage = $("#stage").text().trim();
                    key_pattern = $("#pattern").text().trim();
                    key_name = $("#sqb1-step-name").val();
                    keydir1 = $("#sqb1-flow-dir").val();
                    keydir2 = $("#sqb1-second-dir").val();
                    var keyvalue = key_stage+key_pattern+key_name+"sqb2info";
                    sessionStorage.setItem(keyvalue,keydata);
                    sessionStorage.setItem("dirlist1",keydir1);
                    sessionStorage.setItem("dirlist2",keydir2);
                    sqbClick2(data);
                    console.log("success!");
                    l.stop();
                })
                .fail(function() {
                    //$(destId).text("Error: Could not contact server.");
                    l.stop();
                    console.log("fail!")
                });
            }
        })
        if(mode=="1"){

            $(".sqb").css("display", "table");
            $("#sqb1-flow-dir").val(first_dir);
            $("#sqb1-second-dir").val(second_dir);
            if(first_dir!=second_dir){
                $("#sqb-two-flow").css("display","table");
            }
            if(first_pattern=="APS")
            {
                $("#sqb-two-flow").css("display","none");
            }
            $("#stage").text("NW"+first_stage);  
            if(first_stage=="FULL_FLOW"){
                $("#stage").text(first_stage+"_PPA");    
            }       
            $('#sqb_btn').click();
            content = $("#sqb").text();
        
            $("#method").text(content);
            $("#pattern").text(first_pattern);
            $("#sqb1-step-name").val(single_name);
            $("#sqbstep-name-switch").text(single_name);

            $('#sqb_btn1').click();
        }

        if(mode=="4"){

            $(".sqb").css("display", "table");
            $("#sqb1-flow-dir").val(first_dir);
            $("#sqb1-second-dir").val(first_dir);       
            $("#stage").text("NW"+first_stage);    
            if(first_stage=="FULL_FLOW"){
                $("#stage").text(first_stage+"_PPA");    
            }    
            $('#sqb_btn').click();
            content = $("#sqb").text();
        
            $("#method").text(content);
            $("#pattern").text(first_pattern);
            $("#sqb1-step-name").val(single_name);
            $("#sqbstep-name-switch").text(single_name);

            $('#sqb_btn1').click();
        }




        //$(".gain-loss-display").css("display","none");
        
        $('#sqc_btn').click(function(e){
            $(".sqc-summary").css("display","none");
            $(".sqb-summary").css("display","none");
            $("#sqc-hide").css("display","none");
            $(".sqb-chart").css("display","none");
            $(".sqb-switch").css("display","none");
            $(".sqc-chart").css("display","none");
            $(".sqc-switch").css("display","none");
            $("#error-warning").css("display","none");
            var warn = $("#error-warning");
            warn.text("");
            $("#sqccmp-name-switch").val("");
            $("#sqcstep-name-switch").val("");
            $("#sqccmp-name-switch-li").empty();
            $("#sqcstep-name-switch-li").empty();
            $("#cpattern").html("Pattern");
            $("#sqcstep-name-switch").text("Base");
            $("#sqccmp-name-switch").text("Compare");
            $("#sqc-comp-name").val("");

            if( $("#sqc-flow-dir").val()==""){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>flow_dir</strong> should not be empty!");
                return false;
            }
            if($("#cstage").text().trim()=="Stage"){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Stage</strong> Warn! Please choose the right stage! ");
                return false;
            }
            var l = Ladda.create(this);
            l.start();
            key_stage = $("#cstage").text().trim();
            keydir = $("#sqc-flow-dir").val();
            var keyinfo = key_stage+"sqc1info";
            if(sessionStorage.getItem(keyinfo)&&(sessionStorage.getItem('dirlist1')==keydir)){
                    strdata = sessionStorage.getItem(keyinfo);
                    inputdata = JSON.parse(strdata);
                    // lists = sessionStorage.getItem('dirlists');
                    sqcClick1(inputdata);
                    l.stop();
                    // inputdata.selected_pattern = active_pattern;
            }
            else{
            $.post('analysis_sqc', {
                step_name: "",
                base_name: "",
                flow_dir: $("#sqc-flow-dir").val(),
                pattern: first_pattern,
                stage: $("#cstage").text().trim(),
                tech_nodes: JSON.stringify(window.tech_nodes),
                customers: JSON.stringify(window.customers),
            }, function () {
                console.log("sending post...")
            })
                .done(function(data) {
                    // window.steps_list_dict = ["NWPOPT","NWCOPT","NWFOPT"];
                    var keydata = JSON.stringify(data); 
                    key_stage = $("#cstage").text().trim();
                    var keyvalue = key_stage+"sqc1info";
                    keydir = $("#sqc-flow-dir").val()
                    sessionStorage.setItem(keyvalue,keydata);
                    sessionStorage.setItem("dirlist1",keydir);
                    sqcClick1(data);
                    console.log("first start success!");
                    l.stop();
                })
                .fail(function() {
                    //$(destId).text("Error: Could not contact server.");
                    l.stop();
                    console.log("fail!")
                });
            }
        })
        $('#sqc_btn1').click(function(e) {
            $(".sqb-chart").css("display","none");
            $(".sqb-switch").css("display","none");
            $(".sqc-chart").css("display","none");
            $(".sqc-switch").css("display","none");
            $(".sqc-summary").css("display","none");
            $("#error-warning").css("display","none");
            var warn = $("#error-warning");
            warn.text("");
            if( $("#sqc-base-name").val()==""){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Base name</strong> should not be empty!");
                return false;
            }
            if( $("#sqc-comp-name").val()==""){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Compare name</strong> should not be empty!");
                return false;
            }
            if($("#cpattern").text().trim()=="Pattern"){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Pattern </strong> Warn! Please choose the right Pattern! ");
                return false;
            }
            var l = Ladda.create(this);
            l.start();
            key_stage = $("#cstage").text().trim();
            key_pattern = $("#cpattern").text().trim();
            key_name1 = $("#sqc-base-name").val();
            key_name2 = $("#sqc-comp-name").val();
            keydir = $("#sqc-flow-dir").val();
            var keyinfo = key_stage+key_pattern+key_name1+key_name2+"sqc2info";
            if(sessionStorage.getItem(keyinfo)&&(sessionStorage.getItem('dirlist1')==keydir)){
                    strdata = sessionStorage.getItem(keyinfo);
                    inputdata = JSON.parse(strdata);
                    // lists = sessionStorage.getItem('dirlists');
                    sqcClick2(inputdata);
                    l.stop();
                    // inputdata.selected_pattern = active_pattern;
            }
            else{
            $.post('analysis_sqc', {
                base_name: $("#sqc-base-name").val(),
                step_name: $("#sqc-comp-name").val(),
                flow_dir: $("#sqc-flow-dir").val(),
                pattern: $("#cpattern").text().trim(),
                stage: $("#cstage").text().trim(),
                tech_nodes: JSON.stringify(window.tech_nodes),
                customers: JSON.stringify(window.customers),
            }, function () {
                console.log("sending analysis compare post...")
            })
                .done(function(data) {
                    var keydata = JSON.stringify(data); 
                    key_stage = $("#cstage").text().trim();
                    key_pattern = $("#cpattern").text().trim();
                    key_name1 = $("#sqc-base-name").val();
                    key_name2 = $("#sqc-comp-name").val();
                    keydir = $("#sqc-flow-dir").val();
                    var keyvalue = key_stage+key_pattern+key_name1+key_name2+"sqc2info";
                    sessionStorage.setItem(keyvalue,keydata);
                    sessionStorage.setItem("dirlist1",keydir);
                    sqcClick2(data);
                    console.log("compare_analysis success!");
                    l.stop();
                })
                .fail(function() {
                    //$(destId).text("Error: Could not contact server.");
                    l.stop();
                    console.log("fail!")
                });
            }
        })

        if(mode=="2"){
            $(".sqc").css("display", "table");
            $("#sqc-flow-dir").val(first_dir);
            $("#cstage").text("NW"+first_stage);
            if(first_stage=="FULL_FLOW"){
                $("#cstage").text(first_stage+"_PPA");    
            }          
            $('#sqc_btn').click();
            content = $("#sqc").text();
        
            $("#method").text(content);
            $("#cpattern").text(first_pattern);
            $("#sqc-base-name").val(first_name);
            $("#sqc-comp-name").val(second_name);
            $("#sqcstep-name-switch").text(first_name);
            $("#sqccmp-name-switch").text(second_name);
            $('#sqc_btn1').click();
        }


        $('#sqt_btn').click(function(e){
            $("#sqt-hide").css("display","none");
            $(".sqb-chart").css("display","none");
            $(".sqb-switch").css("display","none");
            $(".sqc-chart").css("display","none");
            $(".sqc-switch").css("display","none");
            $(".sqc-summary").css("display","none");
            $(".sqb-summary").css("display","none");
            $(".sqt-chart").css("display","none");
            $(".sqt-switch").css("display","none");
            $(".sqt-summary").css("display","none");

            $("#error-warning").css("display","none");
            var warn = $("#error-warning");
            warn.text("");
            $("#tpattern").html("Pattern");
            if( $("#sqt1-flow-dir").val()==""){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>flow_dir</strong> should not be empty!");
                return false;
            }
            if($("#tstage").text().trim()=="Stage"){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Stage</strong> Warn! Please choose the right stage! ");
                return false;
            }
            var l = Ladda.create(this);
            l.start();
            key_stage = $("#tstage").text().trim();
            keydir = $("#sqt1-flow-dir").val();
            var keyinfo = key_stage+"sqt1info";
            if(sessionStorage.getItem(keyinfo)&&(sessionStorage.getItem('dirlist1')==keydir)){
                    strdata = sessionStorage.getItem(keyinfo);
                    inputdata = JSON.parse(strdata);
                    // lists = sessionStorage.getItem('dirlists');
                    sqtClick1(inputdata);
                    l.stop();
                    // inputdata.selected_pattern = active_pattern;
            }
            else{
            $.post('analysis_sqt', {
                flow_dir: $("#sqt1-flow-dir").val(),
                pattern: first_pattern,
                stage: $("#tstage").text().trim(),
                bound: $("#sqt-bound").val(),
            }, function () {
                console.log("sending post...")
            })
                .done(function(data) {
                    var keydata = JSON.stringify(data); 
                    key_stage = $("#tstage").text().trim();
                    keydir = $("#sqt1-flow-dir").val()
                    var keyvalue = key_stage+"sqt1info";
                    sessionStorage.setItem(keyvalue,keydata);
                    sessionStorage.setItem("dirlist1",keydir);
                    sqtClick1(data);
                    console.log("first start success!");
                    l.stop();
                })
                .fail(function() {
                    //$(destId).text("Error: Could not contact server.");
                    l.stop();
                    console.log("fail!")
                });
            }
        })
        $('#sqt_btn1').click(function(e) {
            //console.log($("#sqb1-step-name").val())
            $(".sqb-chart").css("display","none");
            $(".sqb-switch").css("display","none");
            $(".sqc-chart").css("display","none");
            $(".sqc-switch").css("display","none");
            $(".sqt-summary").css("display","none");
            $("#error-warning").css("display","none");

            var warn = $("#error-warning");
            warn.text("");
            if($("#tpattern").text().trim()=="Pattern"){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Pattern</strong> Warn! Please choose the right pattern! ");
                return false;
            }
            if($("#sqt-bound").val()==""){
                warn.css("display","block");
                warn.attr("class","alert alert-warning");
                warn.append("<strong>Bound number</strong> should not be empty!");
                return false;
            }
            var l = Ladda.create(this);
            l.start();
            key_stage = $("#tstage").text().trim();
            key_pattern = $("#tpattern").text().trim();
            key_number = $("#sqt-bound").val();
            keydir = $("#sqt1-flow-dir").val();
            var keyinfo = key_stage+key_pattern+key_number+"sqt2info";
            if(sessionStorage.getItem(keyinfo)&&(sessionStorage.getItem('dirlist1')==keydir)){
                    strdata = sessionStorage.getItem(keyinfo);
                    inputdata = JSON.parse(strdata);
                    // lists = sessionStorage.getItem('dirlists');
                    sqtClick2(inputdata);
                    l.stop();
                    // inputdata.selected_pattern = active_pattern;
            }
            else{
            $.post('analysis_sqt', {
                flow_dir: $("#sqt1-flow-dir").val(),
                pattern: $("#tpattern").text().trim(),
                stage: $("#tstage").text().trim(),
                bound: $("#sqt-bound").val(),
            }, function () {
                console.log("sending post...")
            })
                .done(function(data) {
                    //var thHTML='<thead><tr><th data-sortable="true" data-field="design_name"> design_name </th>
                    // <th data-sortable="true" data-field="step_name"> step_name </th><th data-sortable="true" data-field="step_val">
                    // step_val</th><th data-sortable="true" data-field="base_step"> base_step </th><th data-sortable="true" data-field="base_val">
                    // base_val</th><th data-sortable="true" data-field="Gain-Loss"> Gain/Loss Pct.</th></tr></thead>'
                    //$("#sqb_bs_table").append(thHTML)\
                    // window.steps_list_dict = ["NWPOPT","NWCOPT","NWFOPT"];
                    var keydata = JSON.stringify(data); 
                    key_stage = $("#tstage").text().trim();
                    key_pattern = $("#tpattern").text().trim();
                    key_number = $("#sqt-bound").val();
                    keydir = $("#sqt1-flow-dir").val();
                    var keyvalue = key_stage+key_pattern+key_number+"sqt2info";
                    sessionStorage.setItem(keyvalue,keydata);
                    sessionStorage.setItem("dirlist1",keydir);
                    sqtClick2(data);
                    console.log("success!");
                    l.stop();
                })
                .fail(function() {
                    //$(destId).text("Error: Could not contact server.");
                    l.stop();
                    console.log("fail!")
                });
            }
        })

        if(mode=="3"){
            $(".sqt").css("display", "table");
            $("#sqt1-flow-dir").val(first_dir);
            $("#tstage").text("NW"+first_stage);
            if(first_stage=="FULL_FLOW"){
                $("#tstage").text(first_stage+"_PPA");    
            }  
            $('#sqt_btn').click();        
            content = $("#sqt").text();
            
            $("#method").text(content);
            $("#tpattern").text(first_pattern);
            $("#sqt-bound").val(number);
            $('#sqt_btn1').click();
        }

        $('#sqa_btn').click(function(e) {
            //$(".gain-loss-display").css("display","none");
            var l = Ladda.create(this);
            l.start();
            $.post('analysis_sqa', {
                flowb_dir: $("#sqa1-flowb-dir").val(),
                flowc_dir: $("#sqa1-flowc-dir").val(),
            }, function () {
                console.log("sending post...")
            })
                .done(function(data) {
                    window.bs_data = []
                    $(".sqa").css("display","none");

                    console.log("success!")
                    l.stop();
                })
                .fail(function() {
                    l.stop();
                    console.log("fail!")
                });
        })
    });

    //cmd stats
    var ctx = $("#myChart").get(0).getContext("2d");
    // This will get the first returned node in the jQuery collection.
    var data1 = {
        labels: ["-100%+", "-100%", "(-100%~-80%]", "(-80%+~-50%]","(-50%~-20%]", "(-20%~-10%]", "(-10%~-0%)", "0%", "(+0%~+10%)", "[+10%~+20%)", "[+20%~+50%)", "[+50%~+80%)", "[+80%~+100%)", "+100%", "+100%+"],
        datasets: [
            {
                label: "qor distribution",
                backgroundColor: [
                    'rgba(153, 204, 51, 1)',
                    'rgba(153, 204, 51, 0.9)',
                    'rgba(153, 204, 51, 0.8)',
                    'rgba(153, 204, 51, 0.6)',
                    'rgba(153, 204, 51, 0.5)',
                    'rgba(153, 204, 51, 0.3)',
                    'rgba(153, 204, 51, 0.1)',
                    'rgba(119, 119, 119, 0.2)',
                    'rgba(255, 99, 132, 0.1)',
                    'rgba(255, 99, 132, 0.3)',
                    'rgba(255, 99, 132, 0.5)',
                    'rgba(255, 99, 132, 0.6)',
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(255, 99, 132, 0.9)',
                    'rgba(255, 99, 132, 1)',
                    //'rgba(255, 99, 132, 0.2)',
                    //'rgba(54, 162, 235, 0.2)',
                    //'rgba(255, 206, 86, 0.2)',
                    //'rgba(75, 192, 192, 0.2)',
                    //'rgba(153, 102, 255, 0.2)',
                    //'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(119, 119, 119, 0.8)',
                    'rgba(255,99,132,1)',
                    'rgba(255,99,132,1)',
                    'rgba(255,99,132,1)',
                    'rgba(255,99,132,1)',
                    'rgba(255,99,132,1)',
                    'rgba(255,99,132,1)',
                    'rgba(255,99,132,1)',
                    //'rgba(54, 162, 235, 1)',
                    //'rgba(255, 206, 86, 1)',
                    //'rgba(75, 192, 192, 1)',
                    //'rgba(153, 102, 255, 1)',
                    //'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1,
                data: [65, 59, 80, 81, 56, 55, 40, 22, 45, 68, 34, 67 ,67, 23, 88],
            },
        ],
    };
/*
    Chart.pluginService.register({
        beforeRender: function (chart) {
            if (chart.config.options.showAllTooltips) {
                // create an array of tooltips
                // we can't use the chart tooltip because there is only one tooltip per chart
                chart.pluginTooltips = [];
                chart.config.data.datasets.forEach(function (dataset, i) {
                    chart.getDatasetMeta(i).data.forEach(function (sector, j) {
                        chart.pluginTooltips.push(new Chart.Tooltip({
                            _chart: chart.chart,
                            _chartInstance: chart,
                            _data: chart.data,
                            _options: chart.options.tooltips,
                            _active: [sector]
                        }, chart));
                    });
                });

                // turn off normal tooltips
                chart.options.tooltips.enabled = false;
            }
        },
        afterDraw: function (chart, easing) {
            if (chart.config.options.showAllTooltips) {
                // we don't want the permanent tooltips to animate, so don't do anything till the animation runs atleast once
                if (!chart.allTooltipsOnce) {
                    if (easing !== 1)
                        return;
                    chart.allTooltipsOnce = true;
                }

                // turn on tooltips
                chart.options.tooltips.enabled = true;
                Chart.helpers.each(chart.pluginTooltips, function (tooltip) {
                    console.log(window.selected_designs);
                    //tooltip.initialize();
                    //tooltip.update();
                    // we don't actually need this since we are not animating tooltips
                    //tooltip.pivot();
                    //tooltip.transition(easing).draw();
                });
                //chart.options.tooltips.enabled = false;
            }
        }
    })
*/
    var myBarChart = new Chart(ctx, {
        type: 'bar',
        data: data1,
        options: {
            showAllTooltips: true,
            legend: {
                display: false,
            },
            tooltips: {
                callbacks: {
                    label: function(tooltipItem, data) {
                        var allData = data.datasets[tooltipItem.datasetIndex].data;
                        var tooltipLabel = data.labels[tooltipItem.index];
                        var tooltipData = allData[tooltipItem.index];
                        var total = 0;
                        for (var i in allData) {
                            total += allData[i];
                        }
                        var tooltipPercentage = Math.round((tooltipData / total) * 100);
                        return tooltipData + ' (' + tooltipPercentage + '%)';
                    },
                }
            },
            scales: {
                xAxes: [{
                    stacked: true
                }],
                yAxes: [{
                    stacked: true
                }]
            },
        }
    });

    $("#myChart").click(function (evt) {
        var filter_data = {};
        var index_data = {};
        var activePoints = myBarChart.getElementAtEvent(evt.originalEvent);
        if(activePoints!=""){
            var distri_index = activePoints[0]._index;
            index_data = filterDistriCount(window.bs_data);
            filter_data = index_data[distri_index];
            //console.log(distri_index);
        }
        else{
            filter_data = window.bs_data;
        }
        $('#sqb_bs_table').bootstrapTable('destroy').bootstrapTable({
            //toolbar: '#toolbar',                //工具按钮用哪个容器
            striped: true,                      //是否显示行间隔色
            //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true,                   //是否显示分页（*）
            sortable: true,                     //是否启用排序
            pageNumber:1,                       //初始化加载第一页，默认第一页
            pageSize: 50,                       //每页的记录行数（*）
            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
            search: true,
            showExport: true,                    //是否显示导出
            exportDataType: "all",
            showColumns: true,
            columns: [{
                field: 'design_name',
                title: 'Design Name',
                sortable: true
            }, {
                field: 'base_name',
                title: 'Base Step',
                sortable: true
            }, {
                field: 'base_val',
                title: 'Base Value',
                sortable: true
            }, {
                field: 'step_name',
                title: 'Step Name',
                sortable: true
            }, {
                field: 'step_val',
                title: 'Step Value',
                sortable: true
            }, {
                field: 'pct',
                title: 'Percentage (%)',
                sortable: true
            },{
                field: 'link',
                title: 'Profile link',
                sortable: true
            }
            ],
            data: filter_data
        })
    });

</script>
<nav class="navbar navbar-inverse navbar-fixed-top">

    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#" style="color:#fff;">QoR Analyzer Web</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="{{ url_for('index') }}"><small><span class="glyphicon glyphicon-home"></span></small>&nbsp;&nbsp;Home</a></li>
                <li class="active"><a href="{{ url_for('qor_analysis_tricks') }}"><small><span class="glyphicon glyphicon-stats"></span></small>&nbsp;&nbsp;Analysis</a></li>
                <li><a href="{{ url_for('about') }}"><small><span class="glyphicon glyphicon-info-sign"></span></small>&nbsp;&nbsp;About</a></li>
            </ul>

        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class="container bs-docs-container" role="main">
    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="row" style="margin-left: -100px;margin-right: -100px">
        <div class="col-md-12" role="main">
        <!--
            <div class="alert alert-info alert-dismissible" role="alert">
                <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                New analysis functions are ready now:</br>
                2017-02-27: <strong>Step QoR Benefit Analysis</strong> for flow"</br>
            </div>
            -->
            <!-- Split button -->
            <div class="row" style="margin-left:0px;">
                <div class="btn-group" style="margin-bottom: 18px;">
                    <button id="method" type="button" class="btn btn-info">Select a Trick</button>
                    <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;">
                        <span class="caret" style="margin-top: 4px"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a href="#" id="sqb" onclick="activeSQBMethod(this);">Step QoR Benefit Analysis</a></li>
                        <li><a href="#" id="sqc" onclick="activeSQCMethod(this);">Steps QoR Compare</a></li>
                        <li><a href="#" id="sqt" onclick="activeSQAMethod(this);">QoR Trajectory Analysis</a></li>
                        <li><a href="#" id="sqa" onclick="activeSQCMethod(this);">Stage QoR Analysis</a></li>
                        <!--<li><a href="#" onclick="activeMode(this);">trend</a></li>-->
                    </ul>
                </div>
                <div id="sqb-two-flow" class="input-group analysis_area" style="display:none;width:800px;margin-bottom:10px;">
                    <span class="input-group-addon" style="display:table-cell;">Compare Dir</span>
                    <input style="width:640px;display:table-cell;" id="sqb1-second-dir" type="text" class=" form-control" placeholder="Flow2 direcroty">
                </div>
                <div class="input-group analysis_area sqb" style="display:none;width:800px;margin-bottom:20px;">

                    <span class="input-group-addon" style="display:table-cell;border-right: 0">Base Dir</span>
                    <input style="width:640px;display:table-cell;" id="sqb1-flow-dir" type="text" class="form-control" placeholder="Flow direcroty">
             <!--        <input style="width:640px;display:none;" id="sqb1-second-dir" type="text" class="form-control" placeholder="Flow2 direcroty"> -->
                    <div class="input-group-btn" >
                        <button id="stage" type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="border-radius:0px;">Stage </button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="#" onclick="activeStage(this);">NWPOPT</a></li>
                            <li><a href="#" onclick="activeStage(this);">NWCOPT</a></li>
                            <li><a href="#" onclick="activeStage(this);">NWFOPT</a></li>
                            <li><a href="#" onclick="activeStage(this);">FULL_FLOW_PPA</a></li>
                        </ul>
                    </div><!-- /btn-group -->
                    <span class="input-group-btn" style="display:table-cell;"><button id="sqb_btn" class="btn btn-primary ladda-button" data-style="expand-right">Start!</button></span>
                </div>

                <div id="sqb-hide" class="input-group analysis_area" style="display:none;width:800px;">
                    <div class="input-group-btn" style="display:table-cell;border-right: 0;float: left;width: 70px" >
                        <button type="button" class="btn btn-warn" style="width:70px;">Pattern</button>
                    </div>
                    <div class="input-group-btn" style="width: 20%;float: left">
                        <button id="pattern" type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="border-radius:0px;width: 133px">Pattern </button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul id="pattern-switch-li" class="dropdown-menu">
                        </ul>
                    </div><!-- /btn-group -->
                    <div class="input-group-btn" style="display:table-cell;border-radius:0px;border-right: 0;float: left;width: 100px" >
                        <button type="button" class="btn btn-warn" style="width:100px;border-radius:0px;">Step Name</button>
                    </div>
                    <div id="sqb1-step-name" class="btn-group" style="margin-bottom: 18px;border-radius:0px;float: left">
                        <button id="sqbstep-name-switch" type="button" class="btn btn-info" style="border-radius:0px;">Step Name</button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul id="sqbstep-name-switch-li" class="dropdown-menu">
                        </ul>
                    </div>
                    <div class="input-group-btn" style="display:table-cell;border-left:0px;float: left"><button id="sqb_btn1" class="btn btn-primary ladda-button" data-style="expand-right" style="border-radius:0px;">Start!</button></div>
                    <div style="clear: both;"></div>
                </div>
                <div class="analysis_area sqb-switch" style="display:none;margin-bottom: 18px;">
                    <div class="btn-group" style="padding-right:10px;display:table-cell;">
                    <button id="sqb-switch" type="button" class="btn btn-warning">Select a Metrics</button>
                    <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;">
                        <span class="caret" style="margin-top: 4px"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul id="sqb-switch-li" class="dropdown-menu">
                    </ul>
                    </div>
                    <div style="border-style: solid; border-width: 1px;border-radius:4px;border-color:white;padding-left: 10px;padding-right:10px;display:table-cell;">
                    <div class="btn-group " style="padding-left: 10px;padding-right:10px;display:table-cell;">
                    <h4 >
                    <span class="label label-primary">Design filter</span>
                    </h4>
                    </div>                  
                    <div class="btn-group" style="display:table-cell;">
                    <select id="sqb-design-select" multiple="multiple" style="margin-left: 15px;padding-left: 15px;">
                    </select>
                    </div>
                    </div>
                </div>
                <div class="input-group analysis_area sqa" style="display:none;margin-bottom:20px;">
                    <div style="display:table;margin-bottom:5px;">
                        <span class="input-group-addon" style="width:120px;display:table-cell;border-right: 0">Base Dir</span>
                        <input style="width:550px;display:table-cell;" id="sqa1-flowb-dir" type="text" class="form-control" placeholder="Base flow direcroty">
                    </div>
                    <div style="display:table;margin-bottom:5px;">
                        <span class="input-group-addon" style="width:120px;display:table-cell;border-right: 0">Compare Dir</span>
                        <input style="width:550px;display:table-cell;" id="sqa1-flowc-dir" type="text" class="form-control" placeholder="Compare flow direcroty">
                        <span class="input-group-btn" style="display:table-cell;"><button id="sqa_btn" class="btn btn-primary ladda-button" data-style="expand-right" style="border-radius:0 4px 4px 0;">Start!</button></span>
                    </div>
                </div>
                <div class="input-group analysis_area sqc" style="width:800px;display:none;margin-bottom:20px;">
                    <span class="input-group-addon" style="width:100px;display:table-cell;border-right: 0">Flow Dir</span>
                    <input style="width:640px;display:table-cell;" id="sqc-flow-dir" type="text" class="form-control" placeholder="Flow direcroty">
                    <div class="input-group-btn">
                        <button id="cstage" type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="border-radius:0px;">Stage </button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="#" onclick="activeSqcStage(this);">NWPOPT</a></li>
                            <li><a href="#" onclick="activeSqcStage(this);">NWCOPT</a></li>
                            <li><a href="#" onclick="activeSqcStage(this);">NWFOPT</a></li>
                            <li><a href="#" onclick="activeSqcStage(this);">FULL_FLOW_PPA</a></li>
                        </ul>
                    </div><!-- /btn-group -->
                    <span class="input-group-btn" style="display:table-cell;"><button id="sqc_btn" class="btn btn-primary ladda-button" data-style="expand-right">Start!</button></span>
                </div>
                <div id="sqc-hide" class="input-group analysis_area" style="width:800px;display:none;">
                    <div class="input-group-btn" style="display:table-cell;border-right: 0;float: left;width: 70px" >
                        <button type="button" class="btn btn-warn" style="width:70px;">Pattern</button>
                    </div>
                    <div class="input-group-btn" style="float: left;width: 20%;border-radius: 4px;border-right: 0px">
                        <button id="cpattern" type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="border-radius:0px;width: 133px">Pattern</button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul id="cpattern-switch-li" class="dropdown-menu">
                        </ul>
                    </div><!-- /btn-group -->
                    <div class="input-group-btn" style="display:table-cell;border-right: 0;float: left;width: 70px" >
                        <button type="button" class="btn btn-warn" style="width:70px;border-radius:0px;">Base</button>
                    </div>
                    <div id="sqc-base-name" class="btn-group" style="margin-bottom: 18px;float: left;border-radius:0px;">
                        <button id="sqcstep-name-switch" type="button" class="btn btn-info" style="border-radius:0px;">Base</button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul id="sqcstep-name-switch-li" class="dropdown-menu">
                        </ul>
                    </div>
                    <div class="input-group-btn" style="display:table-cell;border-radius:0px;float: left;width: 80px" >
                        <button type="button" class="btn btn-warn" style="width:80px;border-radius:0px;">Compare</button>
                    </div>
                    <div id="sqc-comp-name" class="btn-group" style="margin-bottom: 18px;float: left;border-radius:0px;">
                        <button id="sqccmp-name-switch" type="button" class="btn btn-info" style="border-radius:0px;">Compare</button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul id="sqccmp-name-switch-li" class="dropdown-menu">
                        </ul>
                    </div>
                    <div class="input-group-btn" style="display:table-cell;float: left;border-left:0px;"><button id="sqc_btn1" class="btn btn-primary ladda-button" data-style="expand-right" style="border-left:0px;">Start!</button></div>
                    <div style="clear: both"></div>
                </div>
                <div class="btn-group analysis_area sqc-switch" style="display:none;margin-bottom: 18px;">
                    <button id="sqc-switch" type="button" class="btn btn-warning">Select a Metrics</button>
                    <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;">
                        <span class="caret" style="margin-top: 4px"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul id="sqc-switch-li" class="dropdown-menu">
                    </ul>
                    <select id="sqc-design-select" multiple="multiple" style="margin-left: 15px;padding-left: 15px;">
                    </select>
                </div>
                <div class="input-group analysis_area sqt" style="display:none;width:800px;margin-bottom:20px;">
                    <span class="input-group-addon" style="display:table-cell;border-right: 0">Flow Dir</span>
                    <input style="width:640px;display:table-cell;" id="sqt1-flow-dir" type="text" class="form-control" placeholder="Flow direcroty">
                    <div class="input-group-btn" >
                        <button id="tstage" type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="border-radius:0px;">Stage</button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="#" onclick="activeSqtStage(this);">NWPOPT</a></li>
                            <li><a href="#" onclick="activeSqtStage(this);">NWCOPT</a></li>
                            <li><a href="#" onclick="activeSqtStage(this);">NWFOPT</a></li>
                            <li><a href="#" onclick="activeSqtStage(this);">FULL_FLOW_PPA</a></li>
                        </ul>
                    </div><!-- /btn-group -->
                    <span class="input-group-btn" style="display:table-cell;"><button id="sqt_btn" class="btn btn-primary ladda-button" data-style="expand-right">Start!</button></span>
                </div>
                <div id="sqt-hide" class="input-group analysis_area" style="display:none;width:800px;margin-bottom: 20px">
                    <div class="input-group-btn" style="display:table-cell;border-right: 0;float: left;width: 70px" >
                        <button type="button" class="btn btn-warn" style="width:70px;">Pattern</button>
                    </div>
                    <div class="input-group-btn" style="width: 20%;float: left">
                        <button id="tpattern" type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="border-radius:0px;width: 133px">Pattern</button>
                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;border-radius:0px;">
                            <span class="caret" style="margin-top: 4px"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul id="tpattern-switch-li" class="dropdown-menu">
                        </ul>
                    </div><!-- /btn-group -->
                    <div class="input-group-btn" style="display:table-cell;border-radius:0px;float: left;width: 70px" >
                        <button type="button" class="btn btn-warn" style="width:70px;border-radius:0px;">Number</button>
                    </div>
                    <div class="input-group-btn" style="display:table-cell;border-radius:0px;border-right: 0;float: left;width: 75px">
                        <input style="width:75px;display:table-cell;" id="sqt-bound" type="text" class="form-control" placeholder="number">
                    </div>
                    <div class="input-group-btn" style="display:table-cell;border-left:0px;float: left"><button id="sqt_btn1" class="btn btn-primary ladda-button" data-style="expand-right" style="border-radius:0px;">Start!</button></div>
                    <div style="clear: both;"></div>
                </div>
                <div class="btn-group analysis_area sqt-switch" style="display:none;margin-bottom: 18px;">
                    <button id="sqt-switch" type="button" class="btn btn-warning">Select a Metrics</button>
                    <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px;">
                        <span class="caret" style="margin-top: 4px"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul id="sqt-switch-li" class="dropdown-menu">
                    </ul>
                    <select id="sqt-design-select" multiple="multiple" style="margin-left: 15px;padding-left: 15px;">
                    </select>
                </div>
                <div id="error-warning" class="alert alert-danger" role="alert" style="display:none;margin-right: 18px"></div>


            </div>

            <div id ="gain-loss-display1" class="row gain-loss-display sqc-chart">
                <div class="col-md-12 metrics" id="metrics">
                    <div class="panel" style="border-color: #54c7ce;">
                        <!-- Default panel contents -->
                        <div class="panel-heading" style="background-color: #54c7ce; color: white; font-weight: bold">Improve/Degrade Distribution</div>
                        <canvas class="qor_chart" id="SqcmyChart" width="350"></canvas>

                    </div>
                </div>
                <script type="text/javascript">
                    //cmd stats
                    var ctx2 = $("#SqcmyChart").get(0).getContext("2d");
                    // This will get the first returned node in the jQuery collection.
                    var data2 = {
                        labels: ["-100%+", "-100%", "(-100%~-80%]", "(-80%+~-50%]","(-50%~-20%]", "(-20%~-10%]", "(-10%~-0%)", "0%", "(+0%~+10%)", "[+10%~+20%)", "[+20%~+50%)", "[+50%~+80%)", "[+80%~+100%)", "+100%", "+100%+"],
                        datasets: [
                            {
                                label: "qor distribution",
                                backgroundColor: [
                                    'rgba(153, 204, 51, 1)',
                                    'rgba(153, 204, 51, 0.9)',
                                    'rgba(153, 204, 51, 0.8)',
                                    'rgba(153, 204, 51, 0.6)',
                                    'rgba(153, 204, 51, 0.5)',
                                    'rgba(153, 204, 51, 0.3)',
                                    'rgba(153, 204, 51, 0.1)',
                                    'rgba(119, 119, 119, 0.2)',
                                    'rgba(255, 99, 132, 0.1)',
                                    'rgba(255, 99, 132, 0.3)',
                                    'rgba(255, 99, 132, 0.5)',
                                    'rgba(255, 99, 132, 0.6)',
                                    'rgba(255, 99, 132, 0.8)',
                                    'rgba(255, 99, 132, 0.9)',
                                    'rgba(255, 99, 132, 1)',
                                    //'rgba(255, 99, 132, 0.2)',
                                    //'rgba(54, 162, 235, 0.2)',
                                    //'rgba(255, 206, 86, 0.2)',
                                    //'rgba(75, 192, 192, 0.2)',
                                    //'rgba(153, 102, 255, 0.2)',
                                    //'rgba(255, 159, 64, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(119, 119, 119, 0.8)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                ],
                                borderWidth: 1,
                                data: [65, 59, 80, 81, 56, 55, 40, 22, 45, 68, 34, 67 ,67, 23, 88],
                            },
                        ],
                    };
     
                    var myBarChart2 = new Chart(ctx2, {
                        type: 'bar',
                        data: data2,
                        options: {
                            showAllTooltips: true,
                            legend: {
                                display: false,
                                generateLabels: [{
                                    hidden: true,
                                }]
                            },       
                            tooltips: {
                                callbacks: {
                                    label: function(tooltipItem, data) {
                                        if (window.display_designs.length > 0) {
                                            return window.display_designs;
                                        } else {
                                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                                            var tooltipLabel = data.labels[tooltipItem.index];
                                            var tooltipData = allData[tooltipItem.index];
                                            var total = 0;
                                            for (var i in allData) {
                                                total += allData[i];
                                            }
                                            var tooltipPercentage = Math.round((tooltipData / total) * 100);
                                            return tooltipData + ' (' + tooltipPercentage + '%)';
                                        }
                                    },
                                }                         
                            },                    
                            scales: {
                                xAxes: [{
                                    stacked: true
                                }],
                                yAxes: [{
                                    stacked: true
                                }]
                            }
                        }
                    });

                    $("#SqcmyChart").click(function (evt) {
                        var filter_data = {};
                        var index_data = {};
                        var activePoints = myBarChart2.getElementAtEvent(evt.originalEvent);
                        if(activePoints!=""){
                            var distri_index = activePoints[0]._index;
                            index_data = filterDistriCount(window.bs_data);
                            filter_data = index_data[distri_index];
                            //console.log(distri_index);
                        }
                        else{
                            filter_data = window.bs_data;
                        }
                        $('#sqc_bs_table').bootstrapTable('destroy').bootstrapTable({
                            //toolbar: '#toolbar',                //工具按钮用哪个容器
                            striped: true,                      //是否显示行间隔色
                            //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                            pagination: true,                   //是否显示分页（*）
                            sortable: true,                     //是否启用排序
                            pageNumber:1,                       //初始化加载第一页，默认第一页
                            pageSize: 50,                       //每页的记录行数（*）
                            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                            search: true,
                            showExport: true,                    //是否显示导出
                            exportDataType: "all",
                            showColumns: true,
                            columns: [{
                                field: 'design_name',
                                title: 'Design Name',
                                sortable: true
                            },{
                                field: 'base_name',
                                title: 'Base Step',
                                sortable: true
                            }, {
                                field: 'base_val',
                                title: 'Base Value',
                                sortable: true
                            },  {
                                field: 'step_name',
                                title: 'Compare Name',
                                sortable: true
                            }, {
                                field: 'step_val',
                                title: 'Step Value',
                                sortable: true
                            }, {
                                field: 'pct',
                                title: 'Percentage (%)',
                                sortable: true
                            },{
                                field: 'link',
                                title: 'Profile link',
                                sortable: true
                            }
                            ],
                            data: filter_data
                        })
                    });
                </script>
            </div>

            <div class="row gain-loss-display sqc-chart">
                <div class="col-md-12 metrics" id="metrics">
                    <div class="panel" style="border-color: #54c7ce;">
                        <!-- Default panel contents -->
                        <div class="panel-heading" style="background-color: #54c7ce; color: white; font-weight: bold">Step QoR Improve/Degrade Details</div>
                        <div style="padding-left: 5px; padding-right: 5px">
                            <table id="sqc_bs_table"  data-toolbar="#toolbar"
                                   data-show-refresh="true"
                                   data-show-pagination-switch="true"
                                   data-pagination="true"
                                   data-show-toggle="true" style="font-size: 14px">

                            </table>
                        </div>
                    </div>

                </div>
            </div>

            <div id ="gain-loss-display" class="row gain-loss-display sqb-chart">
                <div class="col-md-12 metrics" id="metrics">
                    <div class="panel" style="border-color: #54c7ce;">
                        <!-- Default panel contents -->
                        <div class="panel-heading" style="background-color: #54c7ce; color: white; font-weight: bold">Improve/Degrade Distribution</div>
                        <canvas class="qor_chart" id="myChart" width="350"></canvas>

                    </div>
                </div>
                <script type="text/javascript">
                    //cmd stats
                    var ctx = $("#myChart").get(0).getContext("2d");
                    // This will get the first returned node in the jQuery collection.
                    var data1 = {
                        labels: ["-100%+", "-100%", "(-100%~-80%]", "(-80%+~-50%]","(-50%~-20%]", "(-20%~-10%]", "(-10%~-0%)", "0%", "(+0%~+10%)", "[+10%~+20%)", "[+20%~+50%)", "[+50%~+80%)", "[+80%~+100%)", "+100%", "+100%+"],
                        datasets: [
                            {
                                label: "qor distribution",
                                backgroundColor: [
                                    'rgba(153, 204, 51, 1)',
                                    'rgba(153, 204, 51, 0.9)',
                                    'rgba(153, 204, 51, 0.8)',
                                    'rgba(153, 204, 51, 0.6)',
                                    'rgba(153, 204, 51, 0.5)',
                                    'rgba(153, 204, 51, 0.3)',
                                    'rgba(153, 204, 51, 0.1)',
                                    'rgba(119, 119, 119, 0.2)',
                                    'rgba(255, 99, 132, 0.1)',
                                    'rgba(255, 99, 132, 0.3)',
                                    'rgba(255, 99, 132, 0.5)',
                                    'rgba(255, 99, 132, 0.6)',
                                    'rgba(255, 99, 132, 0.8)',
                                    'rgba(255, 99, 132, 0.9)',
                                    'rgba(255, 99, 132, 1)',
                                    //'rgba(255, 99, 132, 0.2)',
                                    //'rgba(54, 162, 235, 0.2)',
                                    //'rgba(255, 206, 86, 0.2)',
                                    //'rgba(75, 192, 192, 0.2)',
                                    //'rgba(153, 102, 255, 0.2)',
                                    //'rgba(255, 159, 64, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(119, 119, 119, 0.8)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    //'rgba(54, 162, 235, 1)',
                                    //'rgba(255, 206, 86, 1)',
                                    //'rgba(75, 192, 192, 1)',
                                    //'rgba(153, 102, 255, 1)',
                                    //'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1,
                                data: [65, 59, 80, 81, 56, 55, 40, 22, 45, 68, 34, 67 ,67, 23, 88],
                            },
                        ],
                    };

                    Chart.pluginService.register({
                        beforeRender: function (chart) {
                            if (chart.config.options.showAllTooltips) {
                                // create an array of tooltips
                                // we can't use the chart tooltip because there is only one tooltip per chart
                                chart.pluginTooltips = [];
                                chart.config.data.datasets.forEach(function (dataset, i) {
                                    chart.getDatasetMeta(i).data.forEach(function (sector, j) {
                                        chart.pluginTooltips.push(new Chart.Tooltip({
                                            _chart: chart.chart,
                                            _chartInstance: chart,
                                            _data: chart.data,
                                            _options: chart.options.tooltips,
                                            _active: [sector]
                                        }, chart));
                                    });
                                });

                                // turn off normal tooltips
                                chart.options.tooltips.enabled = false;
                            }
                        },
                        afterDraw: function (chart, easing) {
                            if (chart.config.options.showAllTooltips) {
                                // we don't want the permanent tooltips to animate, so don't do anything till the animation runs atleast once
                                if (!chart.allTooltipsOnce) {
                                    if (easing !== 1)
                                        return;
                                    chart.allTooltipsOnce = true;
                                }

                                var i = 0;
                                if (window.selected_designs.length > 0) {
                                    design_qor_dict = window.step_qor_info[window.selected_metrics];
                                    chart.options.tooltips.enabled = true;
                                    Chart.helpers.each(chart.pluginTooltips, function (tooltip) {
                                        window.display_designs = new Array();
                                        $.each(window.selected_designs, function(j, design_name) {
                                            $.each(design_qor_dict[design_name], function(index, qor_data_list) {
                                                if (jQuery.inArray(design_name, window.display_designs) == -1) {
                                                    pct = parseFloat(qor_data_list[4])
                                                    if (i==0) {
                                                        if (pct < -100) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==1) {
                                                        if (pct == -100) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==2) {
                                                        if (pct > -100 && pct <= -80) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==3) {
                                                        if (pct > -80 && pct <= -50) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==4) {
                                                        if (pct > -50 && pct <= -20) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==5) {
                                                        if (pct > -20 && pct <= -10) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==6) {
                                                        if (pct > -10 && pct < 0) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==7) {
                                                        if (pct == 0) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==8) {
                                                        if (pct > 0 && pct < 10) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==9) {
                                                        if (pct >= 10 && pct < 20) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==10) {
                                                        if (pct >= 20 && pct < 50) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==11) {
                                                        //console.log(pct)
                                                        if (pct >= 50 && pct < 80) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==12) {
                                                        if (pct >= 80 && pct < 100) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==13) {
                                                        if (pct == 100) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    } else if (i==14) {
                                                        if (pct > 100) {
                                                            window.display_designs.push(design_name)
                                                        }
                                                    }
                                                }
                                            })
                                        })
                                        //console.log(window.selected_designs);
                                        if (window.display_designs.length>0) {
                                            tooltip.initialize();
                                            tooltip.update();
                                            // we don't actually need this since we are not animating tooltips
                                            tooltip.pivot();
                                            tooltip.transition(easing).draw();
                                        }
                                        i += 1;
                                    });
                                    chart.options.tooltips.enabled = false;
                                } else {
                                    chart.options.tooltips.enabled = true;
                                    Chart.helpers.each(chart.pluginTooltips, function (tooltip) {
                                        //console.log(window.selected_designs);
                                    });
                                }
                            }
                        }
                    })

                    var myBarChart = new Chart(ctx, {
                        type: 'bar',
                        data: data1,
                        options: {
                            showAllTooltips: true,
                            legend: {
                                display: false,
                            },
                            tooltips: {
                                callbacks: {
                                    label: function(tooltipItem, data) {
                                        if (window.display_designs.length > 0) {
                                            return window.display_designs;
                                        } else {
                                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                                            var tooltipLabel = data.labels[tooltipItem.index];
                                            var tooltipData = allData[tooltipItem.index];
                                            var total = 0;
                                            for (var i in allData) {
                                                total += allData[i];
                                            }
                                            var tooltipPercentage = Math.round((tooltipData / total) * 100);
                                            return tooltipData + ' (' + tooltipPercentage + '%)';
                                        }
                                    },
                                }                         
                            },
                            scales: {
                                xAxes: [{
                                    stacked: true
                                }],
                                yAxes: [{
                                    stacked: true
                                }]
                            },
                        }
                    });

                    $("#myChart").click(function (evt) {
                        var filter_data = {};
                        var index_data = {};
                        var activePoints = myBarChart.getElementAtEvent(evt.originalEvent);
                        if(activePoints!=""){
                            var distri_index = activePoints[0]._index;
                            index_data = filterDistriCount(window.bs_data);
                            filter_data = index_data[distri_index];
                            //console.log(distri_index);
                        }
                        else{
                            filter_data = window.bs_data;
                        }
                        $('#sqb_bs_table').bootstrapTable('destroy').bootstrapTable({
                            //toolbar: '#toolbar',                //工具按钮用哪个容器
                            striped: true,                      //是否显示行间隔色
                            //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                            pagination: true,                   //是否显示分页（*）
                            sortable: true,                     //是否启用排序
                            pageNumber:1,                       //初始化加载第一页，默认第一页
                            pageSize: 50,                       //每页的记录行数（*）
                            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                            search: true,
                            showExport: true,                    //是否显示导出
                            exportDataType: "all",
                            showColumns: true,
                            columns: [{
                                field: 'design_name',
                                title: 'Design Name',
                                sortable: true
                            },{
                                field: 'base_name',
                                title: 'Base Step',
                                sortable: true
                            }, {
                                field: 'base_val',
                                title: 'Base Value',
                                sortable: true
                            },  {
                                field: 'step_name',
                                title: 'Step Name',
                                sortable: true
                            }, {
                                field: 'step_val',
                                title: 'Step Value',
                                sortable: true
                            }, {
                                field: 'pct',
                                title: 'Percentage (%)',
                                sortable: true
                            },{
                                field: 'link',
                                title: 'Profile link',
                                sortable: true
                            }
                            ],
                            data: filter_data
                        })
                    });
                </script>
            </div>

            <div class="row gain-loss-display sqb-chart">
                <div class="col-md-12 metrics" id="metrics">
                    <div class="panel" style="border-color: #54c7ce;">
                        <!-- Default panel contents -->
                        <div class="panel-heading" style="background-color: #54c7ce; color: white; font-weight: bold">Step QoR Improve/Degrade Details</div>
                        <div style="padding-left: 5px; padding-right: 5px">
                            <table id="sqb_bs_table"  data-toolbar="#toolbar"
                                   data-show-refresh="true"
                                   data-show-pagination-switch="true"
                                   data-pagination="true"
                                   data-show-toggle="true" style="font-size: 14px">

                            </table>
                        </div>
                    </div>

                </div>
            </div>

            <div id ="gain-loss-display" class="row gain-loss-display sqt-chart">
                <div class="col-md-12 metrics" id="metrics">
                    <div class="panel" style="border-color: #54c7ce;">
                        <!-- Default panel contents -->
                        <div class="panel-heading" style="background-color: #54c7ce; color: white; font-weight: bold">Improve/Degrade Distribution</div>
                        <canvas class="qor_chart" id="SqtmyChart" width="350"></canvas>

                    </div>
                </div>
                <script type="text/javascript">
                    //cmd stats
                    var ctxt = $("#SqtmyChart").get(0).getContext("2d");
                    // This will get the first returned node in the jQuery collection.
                    var datat = {
                        labels: ["-100%+", "-100%", "(-100%~-80%]", "(-80%+~-50%]","(-50%~-20%]", "(-20%~-10%]", "(-10%~-0%)", "0%", "(+0%~+10%)", "[+10%~+20%)", "[+20%~+50%)", "[+50%~+80%)", "[+80%~+100%)", "+100%", "+100%+"],
                        datasets: [
                            {
                                label: "qor distribution",
                                backgroundColor: [
                                    'rgba(153, 204, 51, 1)',
                                    'rgba(153, 204, 51, 0.9)',
                                    'rgba(153, 204, 51, 0.8)',
                                    'rgba(153, 204, 51, 0.6)',
                                    'rgba(153, 204, 51, 0.5)',
                                    'rgba(153, 204, 51, 0.3)',
                                    'rgba(153, 204, 51, 0.1)',
                                    'rgba(119, 119, 119, 0.2)',
                                    'rgba(255, 99, 132, 0.1)',
                                    'rgba(255, 99, 132, 0.3)',
                                    'rgba(255, 99, 132, 0.5)',
                                    'rgba(255, 99, 132, 0.6)',
                                    'rgba(255, 99, 132, 0.8)',
                                    'rgba(255, 99, 132, 0.9)',
                                    'rgba(255, 99, 132, 1)',
                                    //'rgba(255, 99, 132, 0.2)',
                                    //'rgba(54, 162, 235, 0.2)',
                                    //'rgba(255, 206, 86, 0.2)',
                                    //'rgba(75, 192, 192, 0.2)',
                                    //'rgba(153, 102, 255, 0.2)',
                                    //'rgba(255, 159, 64, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(119, 119, 119, 0.8)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    'rgba(255,99,132,1)',
                                    //'rgba(54, 162, 235, 1)',
                                    //'rgba(255, 206, 86, 1)',
                                    //'rgba(75, 192, 192, 1)',
                                    //'rgba(153, 102, 255, 1)',
                                    //'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1,
                                data: [65, 59, 80, 81, 56, 55, 40, 22, 45, 68, 34, 67 ,67, 23, 88],
                            },
                        ],
                    };


                    var myBarChart3 = new Chart(ctxt, {
                        type: 'bar',
                        data: datat,
                        options: {
                            showAllTooltips: true,
                            legend: {
                                display: false,
                            },
                            tooltips: {
                                callbacks: {
                                    label: function(tooltipItem, data) {
                                        if (window.display_designs.length > 0) {
                                            return window.display_designs;
                                        } else {
                                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                                            var tooltipLabel = data.labels[tooltipItem.index];
                                            var tooltipData = allData[tooltipItem.index];
                                            var total = 0;
                                            for (var i in allData) {
                                                total += allData[i];
                                            }
                                            var tooltipPercentage = Math.round((tooltipData / total) * 100);
                                            return tooltipData + ' (' + tooltipPercentage + '%)';
                                        }
                                    },
                                }                         
                            },
                            scales: {
                                xAxes: [{
                                    stacked: true
                                }],
                                yAxes: [{
                                    stacked: true
                                }]
                            },
                        }
                    });

                    $("#SqtmyChart").click(function (evt) {
                        var filter_data = {};
                        var index_data = {};
                        var activePoints = myBarChart3.getElementAtEvent(evt.originalEvent);
                        if(activePoints!=""){
                            var distri_index = activePoints[0]._index;
                            index_data = filterDistriCount(window.bs_data);
                            filter_data = index_data[distri_index];
                            //console.log(distri_index);
                        }
                        else{
                            filter_data = window.bs_data;
                        }
                        $('#sqt_bs_table').bootstrapTable('destroy').bootstrapTable({
                            //toolbar: '#toolbar',                //工具按钮用哪个容器
                            striped: true,                      //是否显示行间隔色
                            //cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                            pagination: true,                   //是否显示分页（*）
                            sortable: true,                     //是否启用排序
                            pageNumber:1,                       //初始化加载第一页，默认第一页
                            pageSize: 50,                       //每页的记录行数（*）
                            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                            search: true,
                            showExport: true,                    //是否显示导出
                            exportDataType: "all",
                            showColumns: true,
                            columns: [{
                                field: 'design_name',
                                title: 'Design Name',
                                sortable: true
                            },{
                                field: 'base_name',
                                title: 'Base Step',
                                sortable: true
                            }, {
                                field: 'base_val',
                                title: 'Base Value',
                                sortable: true
                            },  {
                                field: 'step_name',
                                title: 'Step Name',
                                sortable: true
                            }, {
                                field: 'step_val',
                                title: 'Step Value',
                                sortable: true
                            }, {
                                field: 'pct',
                                title: 'Percentage (%)',
                                sortable: true
                            },{
                                field: 'link',
                                title: 'Profile link',
                                sortable: true
                            }
                            ],
                            data: filter_data
                        })
                    });
                </script>
            </div>

            <div class="row gain-loss-display sqt-chart">
                <div class="col-md-12 metrics" id="metrics">
                    <div class="panel" style="border-color: #54c7ce;">
                        <!-- Default panel contents -->
                        <div class="panel-heading" style="background-color: #54c7ce; color: white; font-weight: bold">Step QoR Improve/Degrade Details</div>
                        <div style="padding-left: 5px; padding-right: 5px">
                            <table id="sqt_bs_table"  data-toolbar="#toolbar"
                                   data-show-refresh="true"
                                   data-show-pagination-switch="true"
                                   data-pagination="true"
                                   data-show-toggle="true" style="font-size: 14px">

                            </table>
                        </div>
                    </div>

                </div>
            </div>

            <div class="row gain-loss-display sqa-chart">
                <div class="col-md-12 metrics" id="metrics">
                    <div class="panel" style="border-color: #54c7ce;">
                        <!-- Default panel contents -->
                        <div class="panel-heading" style="background-color: #54c7ce; color: white; font-weight: bold">Stage QoR Compare</div>
                        <div style="padding-left: 5px; padding-right: 5px">
                            <table id="sqa-table" style="font-size: 14px">

                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- col-9 -->

    </div>
    <div class="row sqb-summary gain-loss-display" style="margin-left: -100px;margin-right: -100px">
    </div>
    <div class="row sqc-summary gain-loss-display" style="margin-left: -100px;margin-right: -100px">
    </div>
    <div class="row sqt-summary gain-loss-display" style="margin-left: -100px;margin-right: -100px">
    </div>
</div>

<nav class="navbar navbar-inverse navbar-fixed-bottom">
    <div class="navbar-inner navbar-content-center" style="text-align:center;">
        <p class="text-muted credit" style="margin:5px 0 0 0;color:white">Chrome/Firefox browsers with 1600x1200+ are suggested</p>
        <p class="text-muted credit" style="margin:0px;color:white">Contact <a href="mailto:phyan@synopsys.com">Leo Yan</a> if needed</p>
    </div>
</nav>

</body>
</html>